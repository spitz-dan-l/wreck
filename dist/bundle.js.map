{"version":3,"sources":["webpack:///webpack/bootstrap c4bc4f5e0ad369211ee0","webpack:///external \"React\"","webpack:///./src/typescript/datatypes.ts","webpack:///./src/typescript/parser.ts","webpack:///./src/typescript/text_tools.ts","webpack:///./src/typescript/commands.ts","webpack:///./src/typescript/venience/venience_world.ts","webpack:///external \"ReactDOM\"","webpack:///./src/components/Text.tsx","webpack:///./src/typescript/keyboard_tools.ts","webpack:///./src/components/Terminal.tsx","webpack:///./src/typescript/parser2.ts","webpack:///./src/components/History.tsx","webpack:///./src/components/Prompt.tsx","webpack:///./src/components/TypeaheadList.tsx","webpack:///./src/typescript/main.tsx","webpack:///./src/typescript/venience/chapters/hex.ts","webpack:///./src/typescript/venience/observer_moments.ts"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c4bc4f5e0ad369211ee0","module.exports = React;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"React\"\n// module id = 0\n// module chunks = 0","export class FuckDict<K, V> {\n    readonly keys_map: Map<string, K>;\n    readonly values_map: Map<string, V>;\n\n    size: number = 0\n\n    constructor(a?: [K, V][]) {\n        this.keys_map = new Map<string, K>();\n        this.values_map = new Map<string, V>();\n\n        if (a !== undefined) {\n            for (let [k, v] of a) {\n                this.set(k, v);\n            }\n        }\n    }\n\n    set(k: K, v: V) {\n        let s = k.toString();\n        this.keys_map.set(s, k);\n        this.values_map.set(s, v);\n        this.size = this.keys_map.size;\n        return this;\n    }\n\n    get(k: K, default_value?: V): V {\n        if (!this.has_key(k) && default_value !== undefined) {\n            this.set(k, default_value);\n            return default_value;\n        }\n        let s = k.toString();\n        return this.values_map.get(s);\n    }\n\n    update(a: [K, V][]): FuckDict<K, V> {\n        let updated = this.copy();\n        for (let [k, v] of a) {\n            updated.set(k, v);\n        }\n        return updated;\n    }\n\n    has_key(k: K) {\n        return this.keys_map.has(k.toString());\n    }\n\n    keys_array() {\n        return Array.from(this.keys_map.values());\n    }\n\n    values_array() {\n        return Array.from(this.values_map.values());\n    }\n\n    entries_array(): [K, V][] {\n        let result: [K, V][] = [];\n        for (let [s, k] of this.keys_map.entries()) {\n            result.push([k, this.values_map.get(s)]);\n        }\n        return result;\n    }\n\n    keys_equal(other: FuckDict<K, V>) {\n        for (let elem of this.keys_array()) {\n            if (!other.has_key(elem)){\n                return false;\n            }\n        }\n\n        for (let elem of other.keys_array()) {\n            if (!this.has_key(elem)){\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    keys_intersect(other: FuckDict<K, V>) {\n        let result: K[] = [];\n        for (let k of this.keys_array()) {\n            if (other.has_key(k)) {\n                result.push(k)\n            }\n        }\n        return result;\n    }\n\n    keys_subset(other: FuckDict<K, V>) {\n        for (let elem of this.keys_array()) {\n            if (!other.has_key(elem)){\n                return false;\n            }\n        }\n        return true;\n    }\n\n    toString() {\n        let entry_strings: string[] = this.entries_array().map((x) => x.toString()).sort();\n\n        return `FuckDict<${entry_strings.join(',')}>`;\n    }\n\n    copy() {\n        return new FuckDict(this.entries_array());\n    }\n}\n\n// export type FuckSet<T> = FuckDict<T, undefined>;\nexport class FuckSet<T> extends FuckDict<T, undefined> {\n    constructor(a?: T[]) {\n        if (a !== undefined) {\n            super(a.map(t => <[T, undefined]>[t, undefined]));\n        } else {\n            super();\n        }\n    }\n}\n\n\nexport function chain_object<T extends object>(src: T) {\n    return new Proxy<T>(src, {\n        get: function (target, key) {\n            if (target[key] === undefined) {\n                target[key] = {};\n            }\n            let v = target[key];\n            if (typeof v === 'object' && !(v instanceof Array)) {\n                return chain_object(v);\n            } else {\n                return v;    \n            }  \n        }    \n    });\n} \n\nexport function chain_update(target: Object, source: Object, replace_keys: string[]=[], inplace=false) {\n    let updated: Object;\n    if (inplace) {\n        updated = target || {};\n    } else {\n        updated = {...target};\n    }\n\n    for (let [n, v] of Object.entries(source)) {\n        if (!replace_keys.includes(n) && typeof v === 'object' && !(v instanceof Array)) {\n            updated[n] = chain_update(updated[n], v, replace_keys, inplace);\n        } else {\n            updated[n] = v;\n        }\n    }\n    return updated;\n}\n\n\ntype Updater = { [K: string]: Updater | ((x: any) => any) };\n\nexport function update(source: any, updater: Updater): any {\n    if (updater.constructor === Object) {\n        let result;\n        if (source.constructor === Object) {\n            result = {...source};\n        } else {\n            result = {};\n        }\n        \n        for (let [n, v] of Object.entries(updater)) {\n            if (v === undefined) {\n                delete result[n];\n            } else {\n                result[n] = update(result[n], v as any);\n            }\n        }\n\n        return result;\n    } else if (updater.constructor === Function){\n        let updater: ((x: any) => any);\n        return updater(source);\n    } else {\n        //just \"replacing\" source with updater\n        let updater: any;\n        return updater;\n    }\n}\n\n// let obj = { a: 1, b: { c: [2,3], d: 5 } };\n// let updated: typeof obj = update(obj, { b: { c: _ => [..._, 4] } } );\n\n// update(obj, { e: { f: _ => 6 }});\n\n// let x = 5;\n\nexport function arrays_fuck_equal<T>(ar1: T[], ar2: T[]) {\n    if (ar1.length !== ar2.length) {\n        return false;\n    }\n\n    for (let i = 0; i < ar1.length; i++) {\n        if (ar1[i].toString() !== ar2[i].toString()) {\n            return false;\n        }\n    }\n    return true;\n}\n\nexport function array_fuck_contains<T>(ar: T[], elt: T){\n    return ar.some((x) => x.toString() === elt.toString())\n}\n\nexport type Point2 = [number, number];\n\nexport function make_matrix2(data_obj: number[][]) {\n    let dim_y = data_obj.length;\n    let dim_x = data_obj[0].length;\n\n    let data = new Int16Array(data_obj.reduce((x, y) => x.concat(y)));\n    // TODO complain if the total length is wrong\n    return new Matrix2(data, dim_x, dim_y);\n}\n\nexport function zeros(dim_x: number, dim_y: number) {\n    return new Matrix2(new Int16Array(dim_x * dim_y), dim_x, dim_y);\n}\n\nexport class Matrix2 {\n    readonly dim_x: number;\n    readonly dim_y: number;\n    readonly data: Int16Array;\n    \n    constructor (data: Int16Array, dim_x: number, dim_y: number) {\n        this.data = data;\n        this.dim_x = dim_x;\n        this.dim_y = dim_y;\n    }\n\n    get(x: number, y: number): number {\n        return this.data[y * this.dim_x + x];\n    }\n\n    set(x: number, y: number, value: number) {\n        this.data[y * this.dim_x + x] = value;\n    }\n\n    rotate(degrees: number): Matrix2 {\n        //validate input better\n\n        if (degrees == 360 || degrees == 0) {\n            return this;\n        }\n\n        const n_rotations = degrees / 90;\n        let m: Matrix2 = this;\n        const dim_x = this.dim_x;\n        const dim_y = this.dim_y;\n        for (let i = 0; i < n_rotations; i++){\n            let new_data = new Int16Array(dim_x * dim_y);\n            let new_mat2 = new Matrix2(new_data, dim_y, dim_x);\n            for (let y = 0; y < dim_y; y++){\n                for (let x = 0; x < dim_x; x++){\n                    new_mat2.set(dim_y - 1 - y, x, m.get(x, y));\n                }\n            }\n            m = new_mat2;\n        }\n        return m\n    }\n\n    contains(value: number): boolean{\n        return this.data.indexOf(value) !== -1;\n    }\n\n    copy(): Matrix2 {\n        return new Matrix2(this.data.slice(), this.dim_x, this.dim_y);\n    }\n}\n\n\nexport type Counter<T> = Map<T, number>;\n\nexport function counter_add<T>(counter: Counter<T>, key: T, inc: number){\n    let cur_val = 0;\n    if (counter.has(key)){\n        cur_val = counter.get(key);\n    }\n    return counter.set(key, cur_val + inc);\n}\n\nexport function counter_get<T>(counter: Counter<T>, key: T){\n    let cur_val = 0;\n    if (counter.has(key)){\n        cur_val = counter.get(key);\n    }\n    return cur_val;\n}\n\nexport function counter_update<T>(counter1: Counter<T>, counter2: Counter<T>){\n    counter2.forEach(function (v, k){\n        counter_add(counter1, k, v);\n    });\n\n    return counter1;\n}\n\nexport function counter_order<T>(counter: Counter<T>, include_zero=false){\n    let result = Array.from(counter.entries()).sort((a, b) => a[1] - b[1]);\n    if (!include_zero) {\n        result = result.filter(([t, i]) => i > 0);\n    }\n    return result.map(([t, i]) => t);\n}\n\n// export type Disablable<T> = T | DWrapped<T>;\n// export type DWrapped<T> = {value: T, disablable: true, enabled: boolean}\n\n// export function is_dwrapped<T>(x: Disablable<T>): x is DWrapped<T>{\n//     return (<DWrapped<T>>x).disablable !== undefined;\n// }\n\n// export function set_enabled<T>(x: Disablable<T>, enabled: boolean=true): Disablable<T>{\n//     if (is_dwrapped(x)) {\n//         if (x.enabled !== enabled) {\n//             x.enabled = enabled; //could do check here for enabled being set properly already\n//         }\n//         return x;\n//     } else {\n//         let result: DWrapped<T> = {value: x, disablable: true, enabled};\n        \n//         return result;\n//     }\n// }\n\n// export function unwrap<T>(x: Disablable<T>): T {\n//     if (is_dwrapped(x)) {\n//         return x.value;\n//     } else {\n//         return x;\n//     }\n// }\n\n// export function with_disablable<T1, T2>(x: Disablable<T1>, f: (t1: T1) => Disablable<T2>): Disablable<T2> {\n//     return set_enabled(unwrap(f(unwrap(x))), is_enabled(x));\n// }\n\n// export function is_enabled<T>(x: Disablable<T>): boolean {\n//     if (is_dwrapped(x)){\n//         return x.enabled;\n//     } else {\n//         return true;\n//     }\n// }\n\nexport type Annotatable<T, AT> = T | Annotated<T, AT>;\nexport type Annotated<T, AT> = {value: T, annotated: true, annotation: Partial<AT>};\n\n//export type _MergeAnnotations<T, A1 extends Annotatable<T, AT1>,  AT1, AT2> = Annotatable<T, AT1 & AT2>\n//export type MergeAnnotations<T, > = \n\nexport function is_annotated<T, AT>(x: Annotatable<T, AT>): x is Annotated<T, AT>{\n    if (x === undefined) {\n        return false;\n    }\n    return (<Annotated<T, AT>>x).annotated !== undefined;\n}\n\nexport function annotate<T, AT>(x: Annotatable<T, AT>, annotation?: Partial<AT>): Annotated<T, AT>{\n    if (annotation === undefined) {\n        annotation = {};\n    }\n    if (is_annotated(x)) {\n        Object.assign(x.annotation, annotation);\n        return x;\n    } else {\n        let result: Annotated<T, AT> = {value: x, annotated: true, annotation};\n        \n        return result;\n    }\n}\n\nexport function unwrap<T, AT>(x: Annotatable<T, AT>): T {\n    if (is_annotated(x)) {\n        return x.value;\n    } else {\n        return x;\n    }\n}\n\nexport function with_annotatable<T1, T2, TA>(f: (t1: T1) => T2, default_value?: TA): (x: Annotatable<T1, TA>) => Annotatable<T2, TA> {\n    return (x: Annotatable<T1, TA>) => annotate(unwrap(f(unwrap(x))), get_annotation(x, default_value));\n}\n\nexport function get_annotation<T, TA>(x: Annotatable<T, TA>, default_value?: TA): Partial<TA> {\n    if (is_annotated(x)){\n        if (default_value !== undefined) {\n            return {...<any>default_value, ...<any>x.annotation};\n        } else {\n            return x.annotation;\n        }\n        \n    } else {\n        return default_value;\n    }\n}\n\nexport type ADisablable = {enabled: boolean};\nexport type Disablable<T> = Annotatable<T, ADisablable>;\n\nexport function set_enabled<T>(x: Disablable<T>, enabled: boolean=true){\n    return annotate(x, {enabled});\n}\n\nexport function with_disablable<T1, T2>(f: (t1: T1) => T2): (x: Disablable<T1>) => Disablable<T2> {\n    return with_annotatable(f, {enabled: true});\n}\n\nexport function is_enabled<T>(x: Disablable<T>): boolean {\n    let result = get_annotation(x);\n    if (result === undefined) {\n        return true;\n    }\n\n    return result.enabled;\n}\n\n\nexport type Numbered<T> = Annotatable<T, number>\n\n\nconst enum _StringValidity {\n    valid\n}\n\nexport type StringValidity = _StringValidity | string;\n\nexport class StringValidator {\n    static validate<V extends StringValidator>(s: string): s is ValidString<V> {\n        return new this().is_valid(s);\n    }\n\n    is_valid(s: ValidatedString<this>): s is ValidString<this> {\n        return false;\n    }\n}\n\nexport type ValidatedString<V extends StringValidator> = string & StringValidity;\nexport type ValidString<V extends StringValidator> = string & _StringValidity.valid;\n\n\n// Holy dang this is cool:\n// https://stackoverflow.com/questions/46445115/derive-a-type-a-from-a-list-of-strings-a\n//\n// Point here is to define the list of ObserverMomentIDs and PerceptionIDs\n// as a constant, and get string literal typechecking elsewhere in the code.\nexport function infer_literal_array<T extends string>(...arr: T[]): T[] {\n  return arr;\n}\n\nexport function struct<K extends string, R extends object>(kind: K, rest?: R) {\n    return { ...rest, kind };\n}\n\nlet r = struct('Horse', {kind: 4});\n\nlet x = r.kind\n\n// A Struct is a tuple whose first element is an enum containing the rest of the struct's field names\ntype Struct = {0:{[k: string]: any}};\ntype StructType<S extends Struct> = S[0];\ntype StructFields<S extends Struct> = keyof StructType<S>;\ntype StructProxy<S extends Struct> = { [K in StructFields<S>]: StructType<S>[K]}\n\nexport function field_getter<S extends Struct>(x: S): StructProxy<S> {\n    let result: any = {};\n    for (let key in x[0]) {\n        Object.defineProperty(result, key, {\n            get: () => x[x[0][key]]\n        });\n    }\n    return result;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/datatypes.ts","import {starts_with, tokenize, untokenize, normalize_whitespace, split_tokens} from './text_tools';\n\nimport {\n    Annotatable,\n    Annotated,\n    annotate,\n    is_annotated,\n    with_annotatable,\n    get_annotation,\n    ADisablable,\n    Disablable,\n    unwrap,\n    is_enabled,\n    set_enabled,\n    with_disablable,\n    array_fuck_contains,\n    StringValidator,\n    ValidatedString,\n    ValidString\n} from './datatypes';\n\n\nexport type Token = string;\n\nexport enum DisplayEltType {\n    keyword = 0,\n    option = 1,\n    filler = 2,\n    partial = 3,\n    error = 4\n}\n\nexport type ADisplayable = {display: DisplayEltType};\nexport type Displayable<T> = Annotatable<T, ADisplayable>;\nexport function set_display<T>(x: Displayable<T>, display: DisplayEltType){\n    return annotate(x, {display});\n}\nexport type AMatch = (ADisplayable & ADisablable);\n\nexport interface DisplayElt {\n    display: DisplayEltType, // the intended display style for this element\n    match: string, // the string that the parser matched for this element\n    typeahead?: Disablable<string>[], // array of typeahead options\n    name?: string, // internal name of this match (probably not useful for rendering purposes)\n}\n\nexport enum MatchValidity {\n    valid = 0,\n    partial = 1,\n    invalid = 2\n}\n\nexport class CommandParser {\n    command: string;\n    tokens: Token[];\n    token_gaps: string[];\n    position: number = 0;\n    validity: MatchValidity = MatchValidity.valid;\n    match: DisplayElt[] = [];\n    tail_padding: string = '';\n\n    constructor(command: string) {\n        this.command = command;\n        [this.tokens, this.token_gaps] = tokenize(command);\n    }\n\n    consume_exact(spec_tokens: Token[], display: DisplayEltType=DisplayEltType.keyword, name?: string): boolean {\n        if (spec_tokens.length === 0) {\n            throw new Error(\"Can't consume an empty spec.\");\n        }\n        \n        let match_tokens: Token[] = [];\n        let match_gaps: string[] = [];\n        let pos_offset = 0;\n        for (let spec_tok of spec_tokens) {\n            if (this.position + pos_offset === this.tokens.length) {\n                this.validity = MatchValidity.partial;\n                break; //partial validity\n            }\n            let next_tok = this.tokens[this.position + pos_offset];\n            let next_gap = this.token_gaps[this.position + pos_offset];\n\n            if (spec_tok.toLowerCase() === next_tok.toLowerCase()) {\n                match_tokens.push(next_tok);\n                match_gaps.push(next_gap);\n                pos_offset++;\n                continue;\n            }\n\n            if (starts_with(spec_tok.toLowerCase(), next_tok.toLowerCase())) {\n                match_tokens.push(next_tok);\n                match_gaps.push(next_gap);\n                this.validity = MatchValidity.partial;\n                pos_offset++;\n                break;\n            }\n            this.validity = MatchValidity.invalid;\n            break;   \n        }\n\n        this.position += pos_offset;\n\n\n        if (this.validity === MatchValidity.valid) {\n            this.match.push({\n                display: display,\n                match: untokenize(match_tokens, match_gaps),\n                name: name});\n            return true;\n        }\n\n        if (this.validity === MatchValidity.partial) {\n            if (this.position === this.tokens.length) {\n                this.match.push({\n                    display: DisplayEltType.partial,\n                    match: untokenize(match_tokens, match_gaps),\n                    typeahead: [untokenize(spec_tokens)],\n                    name: name});\n                return false;\n            } else {\n                this.validity = MatchValidity.invalid;\n            }\n        }\n\n        match_tokens.push(...this.tokens.slice(this.position));\n        match_gaps.push(...this.token_gaps.slice(this.position, this.tokens.length));\n        this.position = this.tokens.length;\n        this.match.push({\n            display: DisplayEltType.error,\n            match: untokenize(match_tokens, match_gaps),\n            name: name});\n        return false;\n    }\n\n    subparser() {\n        return new CommandParser(untokenize(this.tokens.slice(this.position), this.token_gaps.slice(this.position)));\n    }\n\n    integrate(subparser: CommandParser) {\n        this.position += subparser.position;\n        this.match.push(...subparser.match);\n        this.validity = subparser.validity;\n    }\n\n    consume_option<S extends string>(option_spec_tokens: (Annotatable<Token[], AMatch>)[], name?: string): S | false{\n        let partial_matches: Disablable<DisplayElt>[] = [];\n        let exact_match_subparser: CommandParser = null;\n        let exact_match_spec_toks: Token[] = null;\n        for (let spec_toks of option_spec_tokens) {\n            let subparser = this.subparser();\n            let annotation = get_annotation(spec_toks, {display: DisplayEltType.option, enabled: true})\n            let display = annotation.display;\n            let is_exact_match = subparser.consume_exact(unwrap(spec_toks), annotation.display, name);\n\n            if (annotation.enabled){\n                if (is_exact_match) {\n                    exact_match_subparser = subparser;\n                    exact_match_spec_toks = unwrap(spec_toks);\n                    continue;\n                }\n\n                if (subparser.validity === MatchValidity.partial){\n                    partial_matches.push(subparser.match[0]);\n                }\n            } else {\n                if (is_exact_match || subparser.validity === MatchValidity.partial){\n                    let disabled_match = set_enabled(subparser.match[0], false);\n                    partial_matches.push(disabled_match);\n                }\n            }\n        }\n        \n        if (exact_match_subparser !== null) {\n            let typeahead = partial_matches.map(with_disablable((x) => unwrap(x.typeahead[0])));\n            // let typeahead = partial_matches.map( (de) => with_disablable(de, (x) => x.typeahead[0]));\n            this.integrate(exact_match_subparser);\n            this.match[this.match.length-1].typeahead = typeahead;\n\n            return <S>normalize_whitespace(untokenize(exact_match_spec_toks));\n        }\n\n        if (partial_matches.length > 0) {\n            this.validity = MatchValidity.partial;\n            this.position = this.tokens.length - 1;\n            let typeahead = partial_matches.map(with_disablable((x) => unwrap(x.typeahead[0])));\n            this.match.push({\n                display: DisplayEltType.partial,\n                match: unwrap(partial_matches[0]).match,\n                typeahead: typeahead,\n                name: name,\n            });\n            return false;\n        }\n\n        return this.invalidate();\n    }\n\n    invalidate(): false {\n        this.validity = MatchValidity.invalid;\n        let match_tokens = this.tokens.slice(this.position);\n        let match_token_gaps = this.token_gaps.slice(this.position, this.tokens.length);\n        this.match.push({\n            display: DisplayEltType.error,\n            match: untokenize(match_tokens, match_token_gaps),\n            name: name});\n        this.position = this.tokens.length;\n        return false;\n    }\n\n    consume_filler(spec_tokens: Token[]){\n        return this.consume_exact(spec_tokens, DisplayEltType.filler);\n    }\n\n    is_done() {\n        if (this.position === this.tokens.length - 1 && this.tokens[this.tokens.length - 1] === ''){\n            return this.validity === MatchValidity.valid;\n        }\n\n        if (this.position !== this.tokens.length) {\n            return false;\n        }\n\n        return this.validity === MatchValidity.valid;\n    }\n\n    done() {\n        if (!this.is_done() /*this.position !== this.tokens.length */) {\n            this.validity = MatchValidity.invalid;\n            this.match.push({\n                display: DisplayEltType.error,\n                match: untokenize(this.tokens.slice(this.position), this.token_gaps.slice(this.position, this.tokens.length))\n            });\n            this.position = this.tokens.length;\n        } else {\n            if (this.position === this.tokens.length - 1) {\n                this.tail_padding = this.token_gaps[this.token_gaps.length - 1];\n            }\n        }\n\n        return this.validity === MatchValidity.valid;\n    }\n\n    get_match(name: string){\n        for (let m of this.match) {\n            if (m.name === name) {\n                return m;\n            }\n        }\n        return null;\n    }\n}\n\nexport function stop_early<R>(gen: IterableIterator<string | boolean>): R | undefined{\n    let value: any | boolean = undefined;\n    let done: boolean = false;\n\n    while (!done) {\n        let result = gen.next(value);\n        value = result.value;\n        done = result.done;\n        if (value === false) {\n            return;\n        }\n    }\n\n    return <R>value;\n}\n\nexport let with_early_stopping = <R>(gen_func: (...args: any[]) => IterableIterator<any>): (...args: any[]) => R => {\n    let inner = (...args) => {\n        let gen = gen_func(...args);\n        return <R>stop_early(gen);\n    }\n    return <(...args: any[]) => R>inner;\n}\n\nexport function with_early_stopping2<R, T>(gen_func: (this: T, ...args: any[]) => IterableIterator<any>): (...args: any[]) => R {\n    let inner = (...args) => {\n        let gen = gen_func.call(this, ...args);\n        return <R>stop_early(gen);\n    }\n    return <(...args: any[]) => R>inner;\n}\n\nexport function combine<R>(parser: CommandParser, consumers: ((parser: CommandParser) => (R | false))[]) {\n    type Thread = {\n        result: R | false,\n        subparser: CommandParser\n    }\n    let threads: Thread[] = [];\n\n    for (let c of consumers) {\n        let sp = parser.subparser();\n        threads.push({\n            result: c.call(this, sp),\n            subparser: sp,\n        });\n    }\n\n    let partial_matches: Thread[] = [];\n\n    for (let t of threads) {\n        if (t.subparser.is_done()) {\n            parser.integrate(t.subparser);\n            return t.result;\n        } else {\n            if (t.subparser.validity === MatchValidity.partial) {\n                partial_matches.push(t);\n            }\n        }\n    }\n\n    if (partial_matches.length > 0) {\n        //integrate the first one\n        parser.integrate(partial_matches[0].subparser);\n        let final_typeahead = parser.match[parser.match.length - 1].typeahead;\n        let final_t_strings = final_typeahead.map(unwrap);\n        for (let p of partial_matches.slice(1)) {\n            //extend the typeahead with the rest\n            let typeahead = p.subparser.match[p.subparser.match.length - 1].typeahead;\n            for (let t of typeahead) {\n                let t_string = unwrap(t);\n                if (!final_t_strings.includes(t_string)) {\n                    final_typeahead.push(t);\n                    final_t_strings.push(t_string);\n                }\n            }\n        }\n    } else {\n        // set to invalid\n        parser.invalidate();\n    }\n    return false;\n}\n\n// Validator for the mini-language applying to transitions for syntax highlighting\nexport class PhraseDSLValidator extends StringValidator {\n    is_valid(s: ValidatedString<this>): s is ValidString<this> {\n        let toks = tokenize(s)[0];\n        if (toks.slice(1).some(t => \n            t.startsWith('~') || t.startsWith('*') || t.startsWith('&'))) {\n            return false;\n        }\n        return true;\n    }\n}\n\nexport function consume_declarative_dsl(parser: CommandParser, options: ValidatedString<PhraseDSLValidator>[][]) {\n    // assumption: no option is a prefix of any other option\n    let consumers = [];\n\n    for (let option of options) {\n        let opt_consumer = with_early_stopping(function*(parser) {\n            for (let o of option) {\n                let enabled = true;\n                if (o.startsWith('~')) {\n                    enabled = false;\n                    o = o.slice(1);\n                }\n\n                let display: DisplayEltType = DisplayEltType.filler;\n                if (o.startsWith('*')) {\n                    display = DisplayEltType.keyword;\n                    o = o.slice(1);\n                } else if (o.startsWith('&')) {\n                    display = DisplayEltType.option;\n                    o = o.slice(1);\n                }\n\n                let toks = tokenize(o)[0];\n                yield parser.consume_option([annotate(toks, {enabled, display})]);\n            }\n\n            return untokenize(option);\n        });\n\n        consumers.push(opt_consumer);\n    }\n\n    let result = combine.call(this, parser, consumers);\n\n    return result;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/parser.ts","export function uncapitalize(msg: string) {\n    return msg[0].toLowerCase() + msg.slice(1);\n}\n\nexport function capitalize(msg: string) {\n    return msg[0].toUpperCase() + msg.slice(1);\n}\n\n\nexport function starts_with(str: string, searchString: string, position?: number){\n    position = position || 0;\n    return str.substr(position, searchString.length) === searchString;\n}\n\nexport function tokens_equal(tks1: string[], tks2: string[]) {\n    if (tks1.length !== tks2.length) {\n        return false;\n    }\n\n    for (let i = 0; i < tks1.length; i++) {\n        if (tks1[i] !== tks2[i]) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport function tokenize(s: string): [string[], string[]] {\n    let word_pat = /[\\S]+/g;\n    let space_pat = /[^\\S]+/g;\n\n    let tokens = s.split(space_pat);\n    let gaps = s.split(word_pat);\n\n    if (tokens.length > 0){\n        if (tokens[0] === '') {\n            tokens.splice(0, 1);\n        }\n        if (tokens[tokens.length - 1] === '' && gaps[gaps.length - 1] === '') {\n            tokens.splice(tokens.length - 1, 1);\n        }\n    }\n\n    return [tokens, gaps];\n}\n\nexport function split_tokens(s: string): string[] {\n    let space_pat = /[^\\S]+/g;\n    let tokens = s.split(space_pat);\n    if (tokens.length > 0){\n        if (tokens[0] === '') {\n            tokens.splice(0, 1);\n        }\n        if (tokens[tokens.length - 1] === '') {\n            tokens.splice(tokens.length - 1, 1);\n        }\n    }\n    return tokens;\n}\n\nfunction tokenize_tests() {\n    console.log('tokenize tests');\n    console.log(tokenize(' l'));\n}\n\nexport function untokenize(tokens: string[], gaps?: string[]){\n    if (gaps === undefined) {\n        return tokens.join(' ');\n    }\n    \n    let result: string = '';\n    let i = 0;\n    for (i = 0; i < gaps.length; i++){\n        result += gaps[i];\n        if (i < tokens.length) {\n            result += tokens[i];\n        }\n    }\n\n    return result;\n}\n\nexport function get_indenting_whitespace(s: string) {\n    let space_pat = /^[^\\S]+/;\n    let result = space_pat.exec(s);\n    if (result === null){\n        return '';\n    }\n    return result[0];\n}\n\nexport function ends_with_whitespace(s: string) {\n    let last_space_pat = /\\s$/;\n    return last_space_pat.exec(s) !== null;\n}\n\nexport function normalize_whitespace(s: string) {\n    return s.trim().replace(/\\s+/g, ' ');\n}\n\nexport function last(x: any[] | string){\n    return x[x.length - 1];\n}\n\nexport function random_choice(choices: any[]) {\n  var index = Math.floor(Math.random() * choices.length);\n  return choices[index];\n}\n\nexport function dedent(strs: TemplateStringsArray, ...args) {\n    // do interpolation\n    let result: string = strs[0];\n    for (let i = 0; i < args.length; i++) {\n        result += args[i] + strs[i + 1];\n    }\n\n    //find the first newline with whitespace after it\n    let pat = /\\n +/;\n    let m = pat.exec(result);\n\n    if (m === null) {\n        return result\n    }\n\n    let replace_pat = new RegExp(m[0], 'g');\n    let result2 = result.replace(replace_pat, '\\n');\n    \n   return result2;\n}\n\nexport function wrap_in_div(message: string): HTMLElement {\n    let elt = document.createElement('div');\n    elt.innerHTML = message;\n    return elt;\n} \n\n\n// WEBPACK FOOTER //\n// ./src/typescript/text_tools.ts","import {starts_with, tokenize, untokenize, normalize_whitespace, split_tokens} from './text_tools';\n\nimport {\n    Annotatable,\n    annotate,\n    Disablable,\n    unwrap,\n    get_annotation,\n    with_annotatable,\n    with_disablable,\n    set_enabled,\n    is_enabled,\n    chain_update,\n    chain_object\n} from './datatypes';\n\nimport {CommandParser, DisplayEltType, Token, MatchValidity} from './parser';\n\nexport interface CommandHandler<T> {\n    handle_command(this: World<T>, parser: CommandParser): CommandResult<T>\n}\n\nexport interface HistoryInterpreter<T> {\n    interpret_history(this: World<T>, history_elt: InterstitialUpdateResult<T>): HistoryInterpretationOp\n}\n\nexport abstract class World<T> implements CommandHandler<T>, Partial<HistoryInterpreter<T>> {\n    abstract handle_command: (this: World<T>, parser: CommandParser) => CommandResult<T>;\n    abstract interstitial_update?(command_message?: HTMLElement): InterstitialUpdateResult<T>;\n    abstract interpret_history?(history: InterstitialUpdateResult<T>): HistoryInterpretationOp;\n\n    readonly state: T;\n    constructor(state?: T){\n        this.state = state;\n    }\n\n    update(state_updates: T, replace_keys?: string[]): this {\n        let new_state = chain_update(this.state, state_updates, replace_keys);\n        return new (this.constructor as any)(new_state);\n    }\n}\n\nexport type InterstitialUpdateResult<T> = {\n    world?: World<T>;\n    message?: HTMLElement;\n} | undefined;\n\nexport type CommandResult<T> = InterstitialUpdateResult<T> & {\n    parser?: CommandParser;\n} | undefined;\n\nexport type HistoryInterpretation = string[];\n\nexport type HistoryInterpretationOp = ({'add': string} | {'remove': string})[];\n\nexport type PostProcessedCommandResult<T> = CommandResult<T> & {\n    index?: number;\n    message_classes?: HistoryInterpretation;\n}\n\nexport interface Command<T> {\n    command_name: Token[];\n    execute: (world: World<T>, parser: CommandParser) => CommandResult<T>;\n}\n\nexport function apply_command<T> (world: World<T>, cmd: string) {\n    let parser = new CommandParser(cmd);\n\n    let result: CommandResult<T> = {parser: parser, world: world};\n    let cmd_result = world.handle_command(parser)\n    \n    if (cmd_result !== undefined) {\n        if (cmd_result.world !== undefined) {\n            result.world = cmd_result.world;\n        }\n        if (cmd_result.message !== undefined) {\n            result.message = cmd_result.message;\n        }\n\n        result = apply_interstitial_update(result);\n    }\n\n    return result;\n}\n\nfunction apply_interstitial_update<T>(result: CommandResult<T>): CommandResult<T> {\n    if (result.world.interstitial_update !== undefined) {\n        let res2 = result.world.interstitial_update();\n        if (res2 !== undefined) {\n            if (res2.world !== undefined) {\n                result.world = res2.world;\n            }\n            if (res2.message !== undefined) { \n                //assume they updated the original message in some way   \n                result.message = res2.message;\n            }\n        }\n    }\n    return result;\n}\n\nclass HistoryInterpretationError extends Error {};\n\nfunction apply_history_interpretation_op(interp: HistoryInterpretation, op: HistoryInterpretationOp): HistoryInterpretation {\n    if (op === undefined || op.length === 0){\n        return interp;\n    }\n    let new_interp: HistoryInterpretation;\n    if (interp === undefined) {\n        new_interp = [];\n    } else {\n        new_interp = [...interp];\n    }\n    for (let o of op) {\n        if (o['add'] !== undefined){\n            let message_class = o['add'];\n            if (new_interp.indexOf(message_class) === -1) {\n                new_interp.push(message_class);\n            }\n        }\n        if (o['remove'] !== undefined){\n            let message_class = o['remove'];\n            let idx = new_interp.indexOf(message_class);\n            if (idx !== -1) {\n                new_interp.splice(idx, 1);\n            }\n        }\n    }\n    return new_interp;\n}\n\nfunction apply_history_interpretation<T>(history: PostProcessedCommandResult<T>[], world: World<T>): PostProcessedCommandResult<T>[] {\n    if (world.interpret_history === undefined) {\n        return history;\n    } else {\n        let history_input = history.map(({world, message}) => ({world, message}));\n\n        let interp_ops = history_input.map(world.interpret_history, world);\n\n        let new_history = [];\n        for (let i = 0; i < interp_ops.length; i++) {\n            let new_elt = {...history[i]};\n            let msg_clss = new_elt.message_classes;\n            let op = interp_ops[i];\n            new_elt.message_classes = apply_history_interpretation_op(msg_clss, op);\n            new_history.push(new_elt);\n        }\n        return new_history;\n    }\n}\n\nexport class WorldDriver<T> {\n    previous_histories: PostProcessedCommandResult<T>[][] = [];\n\n    history: PostProcessedCommandResult<T>[];\n\n    possible_history: PostProcessedCommandResult<T>[];\n    current_state: CommandResult<T>;\n\n    constructor (initial_world: World<T>) {\n        let initial_result: PostProcessedCommandResult<T> = {world: initial_world};\n        initial_result = apply_interstitial_update(initial_result);\n        initial_result.index = 0;\n        this.history = apply_history_interpretation([initial_result], initial_world);\n \n        this.apply_command('', false); //populate this.current_state\n    }\n\n    apply_command(cmd: string, commit: boolean = true) {\n        let prev_state = unwrap(this.history[this.history.length - 1]);\n        let result: PostProcessedCommandResult<T> = apply_command(prev_state.world, cmd);\n         \n        result.index = prev_state.index + 1;\n\n        this.current_state = result;\n\n        if (this.current_state.parser.validity === MatchValidity.valid) {\n            this.possible_history = apply_history_interpretation([...this.history, this.current_state], this.current_state.world);\n            if (commit) {\n                this.commit();\n            }\n        } else {\n            this.possible_history = this.history;\n        }\n        return result;\n    }\n\n    commit() {\n        //save previous history for posterity\n        this.previous_histories.push(this.history);\n\n        //filter out any disabled history\n        this.history = this.possible_history.filter(is_enabled); //.map(x => annotate(x, 1));\n\n        this.apply_command('', false);\n        return this.current_state;\n    }\n}\n\n// eager dispatch\n\n// type WorldWithEagerDispatch<T> = World<T> & {\n//     get_commands(): Disablable<Command<T>>[],\n// }\n\n// export function eager_dispatch<T>(world: WorldWithEagerDispatch<T>, parser: CommandParser) {\n//     let commands = world.get_commands();\n//     let options = commands.map((cmd) => with_disablable(cmd, (c) => c.command_name));\n    \n//     let cmd_name = parser.consume_option(options, 'command');\n//     let result: CommandResult<T> = {parser: parser, world: world};\n\n//     if (!cmd_name) {\n//         return result;\n//     }\n\n//     let command = unwrap(commands[commands.findIndex((cmd) => (\n//         cmd_name === untokenize(unwrap(cmd).command_name)))]);\n\n//     let cmd_result = command.execute(world, parser);\n\n//     return cmd_result\n// }\n\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/commands.ts","import {\n    CommandResult,\n    CommandHandler,\n    InterstitialUpdateResult,\n    HistoryInterpreter,\n    HistoryInterpretationOp,\n    World\n} from '../commands'\n\nimport {\n    CommandParser,\n    DisplayEltType,\n    with_early_stopping,\n    consume_declarative_dsl,\n    PhraseDSLValidator\n} from '../parser'\n\nimport {\n    FuckDict,\n    FuckSet,\n    array_fuck_contains,\n    set_enabled,\n    annotate,\n    ValidString\n} from '../datatypes';\n\nimport {\n    tokenize,\n    untokenize,\n    wrap_in_div\n} from '../text_tools';\n\nimport {\n    ObserverMomentID,\n    ObserverMoment,\n    PerceptionID,\n    ContentionID,\n    are_transitions_declarative,\n    has_interpretations,\n    are_interpretations_declarative,\n    index_oms,\n    index_perceptions\n} from './observer_moments';\n\nimport hex from './chapters/hex';\n\n// import prologue from './chapters/00_prologue';\n// import chapter_1 from './chapters/01_chapter_1';\n\n//instead of homes, boxes\n\n// Charlotte\n// Southern rural culture\n// Pacifier, baby's clothes, blanket\n// Medical writeup, printed out\n\n// Ben\n// New england mist, trees\n// All notes\n// Musical score of numbers\n\n// Danielle\n// Coffee mug\n// \n\nexport interface VenienceWorldState {\n    experiences?: ObserverMomentID[],\n    history_index?: number,\n    om_state?: {[K in ObserverMomentID]?: any},\n    has_regarded?: {[K in PerceptionID]?: boolean},\n    has_understood?: {[K in ContentionID]?: boolean},\n    has_visited?: {[K in ObserverMomentID]?: boolean}\n}\n\nexport type VenienceWorldCommandHandler = CommandHandler<VenienceWorldState>;\n\nexport type VenienceWorldCommandResult = CommandResult<VenienceWorldState>;\n\nexport type VenienceWorldInterstitialUpdateResult = InterstitialUpdateResult<VenienceWorldState> & {\n    world: VenienceWorld\n}\n\nexport type VenienceWorldHistoryInterpreter = {\n    interpret_history(this: VenienceWorld, history_elt: VenienceWorldInterstitialUpdateResult): HistoryInterpretationOp\n};\n\nexport let wrap_handler = (handler: (this: VenienceWorld, parser: CommandParser) => IterableIterator<any>): (parser: CommandParser) => VenienceWorldCommandResult => \n    function(this: VenienceWorld, parser: CommandParser) { return with_early_stopping(handler.bind(this))(parser); }\n\nexport class VenienceWorld extends World<VenienceWorldState>{\n\n    static observer_moments = index_oms([\n        ...hex.observer_moments(),\n        // ...prologue.observer_moments(),\n        // ...chapter_1.observer_moments()\n    ]);\n\n    static perceptions = index_perceptions([\n        ...hex.perceptions(),\n        // ...prologue.perceptions(),\n        // ...chapter_1.perceptions()\n    ]);\n    \n    constructor({experiences, history_index, om_state, has_regarded, has_understood, has_visited}: VenienceWorldState) {\n        if (experiences === undefined) {\n            experiences = ['imagining 0'];\n        }\n        if (history_index === undefined) {\n            history_index = 0;\n        }\n        if (om_state === undefined) {\n            om_state = {};\n        }\n        if (has_regarded === undefined) {\n            has_regarded = {};\n        }\n        if (has_understood === undefined) {\n            has_understood = {};\n        }\n        if (has_visited === undefined) {\n            has_visited = {};\n        }\n        \n        super({experiences, history_index, om_state, has_regarded, has_understood, has_visited});\n    }\n\n    current_om(): ObserverMomentID {\n        for (let i = this.state.experiences.length - 1; i >= 0; i--) {\n            let exp: ObserverMomentID = this.state.experiences[i];\n            if (exp !== null) {\n                return exp;\n            }\n        }\n        throw \"Somehow got a fully null or empty history.\";\n    }\n\n    get_om_state(om_id: ObserverMomentID) {\n        return this.state.om_state[om_id] || {};\n    }\n\n    get_current_om_state() {\n        return this.get_om_state(this.current_om());\n    }\n\n    transition_to(dest: ObserverMomentID, dest_om_state?: any, message?: HTMLElement | false) {\n        let update: VenienceWorldState = {\n            experiences: [...this.state.experiences, dest],\n            history_index: this.state.history_index + 1,\n            has_visited: {[dest]: true}\n        };\n\n        if (dest_om_state !== undefined) {\n            update.om_state = {\n                [dest]: dest_om_state\n            };\n        }\n\n        let result: VenienceWorldCommandResult = {\n            world: this.update(update)\n        };\n\n        if (message !== false) {\n            if (message === undefined) {\n                let msg: string;\n                let dest_om = VenienceWorld.observer_moments[dest];\n                if (this.state.has_visited[dest] && dest_om.short_enter_message !== undefined) {\n                    msg = dest_om.short_enter_message;\n                } else {\n                    msg = dest_om.enter_message;\n                }\n                if (msg !== undefined) {\n                    result.message = wrap_in_div(msg);\n                }\n            } else {\n                result.message = message;\n            }\n        }\n        return result;\n    }\n\n    get handle_command() {\n        return wrap_handler(function*(parser: CommandParser) {\n            let om = VenienceWorld.observer_moments[this.current_om()];\n\n            if (!are_transitions_declarative(om)) {\n                //dispatch to a more specific handler\n                return om.handle_command.call(this, parser)\n                \n            }\n\n            // we know these are valid because we indexed them\n            // too lazy/busy to thread the validity tag up thru the types :(\n            let cmd_options = <ValidString<PhraseDSLValidator>[][]>om.transitions.map(([cmd, om_id]) => cmd)\n\n            if (cmd_options.length === 0) {\n                yield parser.done();\n                return;\n            }\n\n            let cmd_choice = consume_declarative_dsl(parser, cmd_options);\n\n            if (cmd_choice !== false){\n                yield parser.done();\n            }\n\n            let om_id_choice: ObserverMomentID = this.current_om();\n            om.transitions.forEach(([cmd, om_id]) => {\n                if (cmd_choice === untokenize(cmd)) {\n                    om_id_choice = om_id;\n                }\n            });\n\n            return this.transition_to(om_id_choice);\n\n        });\n    }\n\n    make_look_consumer(look_options: [string[], PerceptionID][], enabled=true) {\n        return wrap_handler(function*(parser: CommandParser){\n            let cmd_enabled = enabled && !look_options.every(([cmd, t]) => this.state.has_regarded[t])\n            \n            yield parser.consume_option([annotate(['look'], {\n                enabled: cmd_enabled,\n                display: DisplayEltType.keyword\n            })]);\n\n            // let options = look_options.map(([opt_toks, t]) => {\n            //     if (this.state.has_regarded[t]) {\n            //         return ['~' + opt_toks[0], ...opt_toks.slice(1)];\n            //     } else {\n            //         return opt_toks;\n            //     }\n            // });\n\n            // let opt = yield consume_option_stepwise_eager(parser, options);\n            // yield parser.done();\n\n            let options = look_options.map(([opt_toks, t]) =>\n                annotate(opt_toks, {\n                    enabled: !(this.state.has_regarded[t] || false),\n                    display: DisplayEltType.filler\n                })\n            );\n\n            let opt = yield parser.consume_option(options);\n            yield parser.done();\n\n            let target: PerceptionID = null;\n            for (let [opt_toks, t] of look_options) {\n                if (untokenize(opt_toks) === opt) {\n                    target = t;\n                    break;\n                }\n            } \n\n            return this.regard(target);\n        });\n    }\n\n    regard(perception_id: PerceptionID, formatter?:(message: string) => HTMLElement) {\n        if (formatter === undefined) {\n            formatter = wrap_in_div;\n        }\n        let result: VenienceWorldCommandResult = {\n            world: this.update({\n                has_regarded: {\n                    [perception_id]: true\n                }\n            }),\n            message: formatter(VenienceWorld.perceptions[perception_id].content)\n        };\n        return result;\n    }\n\n    // make_understand_consumer(understand_options: [string[], ContentionID][], enabled=true) {\n    //     return wrap_handler(function*(parser: CommandParser){\n    //         let cmd_enabled = enabled && !understand_options.every(([cmd, t]) => this.state.has_regarded[t])\n            \n    //         yield parser.consume_option([annotate(['try'], {\n    //             enabled: cmd_enabled,\n    //             display: DisplayEltType.filler\n    //         })]);\n    //         yield parser.consume_filler(['to']);\n            \n    //         // let options = look_options.map(([opt_toks, t]) => {\n    //         //     if (this.state.has_regarded[t]) {\n    //         //         return ['~' + opt_toks[0], ...opt_toks.slice(1)];\n    //         //     } else {\n    //         //         return opt_toks;\n    //         //     }\n    //         // });\n\n    //         // let opt = yield consume_option_stepwise_eager(parser, options);\n    //         // yield parser.done();\n\n    //         let options = understand_options.map(([opt_toks, t]) =>\n    //             set_enabled(opt_toks, !(this.state.has_contended_with[t] || false))\n    //         );\n\n    //         let opt = yield parser.consume_option(options);\n    //         yield parser.done();\n\n    //         let target: ContentionID = null;\n    //         for (let [opt_toks, t] of understand_options) {\n    //             if (untokenize(opt_toks) === opt) {\n    //                 target = t;\n    //                 break;\n    //             }\n    //         } \n\n    //         let result: VenienceWorldCommandResult = {\n    //             world: this.update({\n    //                 has_contended_with: {\n    //                     [target]: true\n    //                 }\n    //             }),\n    //             message: wrap_in_div(VenienceWorld.perceptions[target].content)\n    //         };\n    //         return result;\n    //     });\n    // }\n\n    interstitial_update(message?: HTMLElement) {\n        let result: CommandResult<VenienceWorldState> = {};\n        let world_update: VenienceWorldState = {};\n\n        // apply loop erasure\n        // if (this.state.experiences.length > 0) {\n        //     let loop_idx = this.state.experiences.indexOf(this.current_om());\n        //     if (loop_idx !== this.state.experiences.length - 1) {\n        //         let new_experiences = this.state.experiences.slice().fill(null, loop_idx + 1, this.state.experiences.length - 1);\n        //         world_update.experiences = new_experiences;\n        //     }\n        // }\n\n        if (Object.keys(world_update).length > 0){\n            result.world = this.update(world_update);\n        }\n\n        return result;\n    }\n\n    interpret_history(history_elt: VenienceWorldInterstitialUpdateResult): HistoryInterpretationOp {\n        // apply loop erasure mechanic\n\n        // if (this.state.experiences[history_elt.world.state.history_index] === null) {\n        //     return [{'add': 'forgotten'}];\n        // }\n\n        // apply the OM-specific interpretation\n        let om = VenienceWorld.observer_moments[this.current_om()];\n        if (has_interpretations(om)) {\n            if (are_interpretations_declarative(om)) {\n                return om.interpretations[history_elt.world.current_om()];\n            } else {\n                return om.interpret_history.call(this, history_elt);\n            }\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/venience/venience_world.ts","module.exports = ReactDOM;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactDOM\"\n// module id = 6\n// module chunks = 0","import * as React from 'react';\n\nimport {DisplayEltType, MatchValidity} from '../typescript/parser';\n\nexport const Carat = () => (\n  <span>\n    >&nbsp;\n  </span>\n);\n\nfunction get_display_color(det: DisplayEltType) {\n  switch (det) {\n    case DisplayEltType.keyword:\n      return 'aqua';\n    case DisplayEltType.option:\n      return 'orange';\n    case DisplayEltType.filler:\n      return 'ivory';\n    case DisplayEltType.partial:\n      return 'silver';\n    case DisplayEltType.error:\n      return 'red';\n  }\n}\n\nexport const ParsedText = (props) => {\n  let {parser, typeaheadIndex, children} = props;\n\n  let style: any = {\n    //display: 'inline-block',\n    whiteSpace: 'pre-wrap',\n    position: 'relative'\n  }\n  let validity = parser.validity;\n  if (validity === MatchValidity.valid) {\n    style.fontWeight = '900';\n    //style.fontStyle = 'italic'\n  } else {\n    style.fontWeight = '100';\n    if (validity === MatchValidity.invalid) {\n      style.opacity = '0.6';\n    }\n  }\n\n  const elt_style: any = {\n    //display: 'inline-block'\n  }\n\n  const span_style: any = {\n    //display: 'inline-block'\n  }\n\n  return (\n    <div className=\"parsed-text\" style={{/*display: 'inline-block'*/}}>\n      <Carat />\n      <div style={style}>\n        {(parser === undefined) ? '' : \n          parser.match.map((elt, i) => (\n            <div key={i.toString()} style={{...elt_style, ...{color: get_display_color(elt.display)}}}>\n              <span style={span_style}>\n                {elt.match + ( i === parser.match.length - 1  ? parser.tail_padding : '' ) }\n              </span>\n              { ( i === typeaheadIndex ) ? children : '' }\n            </div>\n          ))\n        }\n      </div>\n    </div>\n  );\n}\n\nexport const OutputText = (props) => {\n  const {message_html} = props;\n\n  return (\n    <div className=\"output-text\" dangerouslySetInnerHTML={{__html: message_html}} />\n  );\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/Text.tsx","export let keys = {\n    tab: 9,\n    enter: 13,\n    left: 37,\n    up: 38,\n    right: 39,\n    down: 40\n};\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/keyboard_tools.ts","import * as React from 'react';\n\nimport {Preface} from './Preface';\nimport {Prompt} from './Prompt';\nimport {ParsedText} from './Text';\nimport {TypeaheadList} from './TypeaheadList';\nimport {History} from './History';\n\nimport {get_indenting_whitespace, ends_with_whitespace} from '../typescript/text_tools';\n\nimport {World, WorldDriver} from \"../typescript/commands\";\n\nimport {MatchValidity} from '../typescript/parser';\n\nimport {is_enabled} from '../typescript/datatypes';\n\nimport * as ReactTransitionGroup from 'react-transition-group';\n\nexport class Terminal<T> extends React.Component<any, {world_driver: WorldDriver<T>}> {\n  contentContainer: any;\n  prompt: any;\n  typeahead_list: any;\n  history: any;\n\n\n  constructor(props) {\n    super(props);\n    this.state = {world_driver: this.props.world_driver};\n  }\n\n  componentDidMount() {\n    this.prompt.focus();\n  }\n\n  handleKeys = (event) => {\n    let swallowed_enter = (this.typeahead_list !== null) ? this.typeahead_list.handleKeys(event) : false;\n    if (!swallowed_enter) {\n      this.prompt.handleKeys(event);\n    }\n  }\n  \n  handleSubmit = () => {\n    if (this.isCurrentlyValid()) {\n      const output = this.state.world_driver.commit();\n      this.setState(\n        {world_driver: this.state.world_driver});\n      this.history.commit_after_update = true;\n      //this.history.commit();\n      return true;\n    }\n    return false;\n  }\n\n  componentDidUpdate() {\n\n  }\n\n  isCurrentlyValid = () => {\n    let parser = this.currentParser();\n    return parser.validity === MatchValidity.valid && parser.is_done();\n  }\n\n  handlePromptChange = (input) => {\n    let result = this.state.world_driver.apply_command(input, false);\n    this.setState({\n      world_driver: this.state.world_driver\n    });\n   this.history.edit_after_update = true;\n    this.prompt.focus();\n    let that = this;\n    window.setTimeout(function() {\n      that.scrollToPrompt();\n    }, 0)\n  }\n\n  handleTypeaheadSelection = (option) => {\n    let matched_tokens = this.currentParser().match.slice(0, this.currentTypeaheadIndex() + 1).map((elt) => elt.match);\n    let current_indentation = this.currentIndentation();\n    if (current_indentation === '' && matched_tokens.length > 1) {\n      current_indentation = ' ';\n    }\n\n    if (option !== false){ \n      let new_last_token = current_indentation + option;\n      matched_tokens[matched_tokens.length - 1] = new_last_token;\n    }\n    let new_command = ''.concat(...matched_tokens) + ' ';\n    this.handlePromptChange(new_command);\n    this.prompt.setState({value: new_command});\n  }\n\n  currentParser = () => this.state.world_driver.current_state.parser;\n\n  currentTypeaheadIndex = () => {\n    let parser = this.currentParser();\n    let typeahead_ind = parser.match.length - 1;\n    let last_match = parser.match[typeahead_ind];\n    if (parser.match.length > 1 && last_match.match === '') {\n      typeahead_ind--;\n    }\n\n    return typeahead_ind;\n  }\n\n  currentTypeahead = () => {\n    let parser = this.currentParser();\n    let typeahead_ind = this.currentTypeaheadIndex();\n\n    if (typeahead_ind === -1) {\n      return [];\n    }\n\n    let typeahead = parser.match[typeahead_ind].typeahead;\n    if (typeahead === undefined) {\n      return [];\n    }\n    return typeahead;\n  }\n\n  currentIndentation = () => {\n    let parser = this.currentParser();\n    let typeahead_ind = this.currentTypeaheadIndex();\n\n    if (typeahead_ind === -1) {\n      return '';\n    }\n\n    return get_indenting_whitespace(parser.match[typeahead_ind].match)\n  }\n\n  scrollToPrompt = () => {\n    if (this.state.world_driver.history.length > 1) {\n      this.prompt.input.scrollIntoView({behavior: \"smooth\", block: \"start\", inline: \"end\"});\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"terminal\" tabIndex={-1} onKeyDown={this.handleKeys} ref={cc => this.contentContainer = cc}>\n        { /*<Preface on_start_game={() => this.prompt.focus()} /> */}\n        <History\n          timeout={700}\n          onAnimationFinish={this.scrollToPrompt}\n          history={this.state.world_driver.history}\n          possible_history={this.state.world_driver.possible_history}\n          ref={h => this.history = h}\n          />\n        <Prompt\n          onSubmit={this.handleSubmit}\n          onChange={this.handlePromptChange}\n          ref={p => this.prompt = p}>\n          <ParsedText\n            parser={this.currentParser()}\n            typeaheadIndex={this.currentTypeaheadIndex()}\n          >\n            <TypeaheadList\n              typeahead={this.currentTypeahead()}\n              indentation={this.currentIndentation()}\n              onTypeaheadSelection={this.handleTypeaheadSelection}\n              ref={t => this.typeahead_list = t}\n            />\n          </ParsedText>\n        </Prompt>\n      </div>\n    );\n  }\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Terminal.tsx","/*\n    a parser thread takes a parser and uses it to consume some of a token stream,\n    and returns some result\n\n    a thread can *split* the current parser state into N branches,\n    each of which consume their own things separately and return their own results\n    the thread which initiated the split is also responsible for combining the various results\n    before returning control to the thread.\n        the most common scenario is that only one of N branches is still valid\n    \n    internally, the parser receives instructions from the parser thread and consumes\n    pieces of the input token stream. it builds up a list of token match objects,\n    where each token in the stream consumed so far gets a status of \"matched\", \"partial\", \"error\"\n\n    by combining these token labellings from all the different parser threads that ran,\n    we determine:\n        - whether the currently-input string is valid and can be executed\n        - what colors to highlight the various input words with\n        - what to display beneath the input prompt as typeahead options\n\n\n\n\n*/\n\nimport { FuckSet, struct } from './datatypes'\nimport { starts_with } from './text_tools'\n\nclass NoMatch extends Error {};\nclass ParseRestart extends Error {\n    constructor(n_splits: number) {\n        super();\n        this.n_splits = n_splits;\n    }\n\n    n_splits: number;\n};\nclass ParseError extends Error {};\n\nconst SUBMIT_TOKEN = Symbol('SUBMIT');\ntype Token = string | typeof SUBMIT_TOKEN;\n\n\nexport class ConsumeSpec {\n    kind: 'ConsumeSpec' = 'ConsumeSpec';\n\n    constructor(\n        public token: ConsumeSpec.TaintedToken,\n        public token_type: ConsumeSpec.TokenType = { kind: 'Filler' },\n        public typeahead_type: ConsumeSpec.TypeaheadType = { kind: 'Available' }\n    ) {}\n\n    static make(obj: ConsumeSpec.Consumable): ConsumeSpec {\n        if (ConsumeSpec.is_token(obj)) {\n            return new ConsumeSpec(obj);\n        }\n        return new ConsumeSpec(obj.token, obj.token_type, obj.typeahead_type);\n    }\n}\n\nexport namespace ConsumeSpec {\n    export type TokenType = \n        { kind: 'Filler' } |\n        { kind: 'Option' } |\n        { kind: 'Keyword' };\n\n    export type TypeaheadType =\n        { kind: 'Available' } |\n        { kind: 'Used' } |\n        { kind: 'Locked' }; // TODO: Need to actually make this invalid when parsed.\n\n    export const NEVER_TOKEN = Symbol('NEVER');\n    export type TaintedToken = Token | typeof NEVER_TOKEN;\n\n    export type Consumable =\n        TaintedToken |\n        (Partial<ConsumeSpec> & { token: TaintedToken });\n\n    export function is_token(x: Consumable): x is TaintedToken {\n        return typeof x === 'string' || x === SUBMIT_TOKEN || x === NEVER_TOKEN;\n    }\n\n    export function is_spec(x: Consumable): x is ConsumeSpec {\n        return !is_token(x);\n    }\n}\n\nexport namespace TokenMatch {\n    export type Match = { kind: 'Match', type: ConsumeSpec.TokenType };\n    export type Partial = { kind: 'Partial', token: Token, type: ConsumeSpec.TypeaheadType };\n    export type Error = { kind: 'Error', token: Token };\n    \n    export type Type = \n        Match |\n        Partial |\n        Error;\n \n    export function is_match(m: Type): m is Match {\n        return m.kind === 'Match'\n    }\n\n    export function is_partial(m: Type): m is Partial {\n        return m.kind === 'Partial'\n    }\n\n    export function is_error(m: Type): m is Error {\n        return m.kind === 'Error'\n    }\n\n    export type TokenMatch = { kind: 'TokenMatch', token: Token, type: Type };\n}\nexport type TokenMatch = TokenMatch.TokenMatch;\n\n/*\n\n    Filler, Option, Error\n\n    Ready, Not Ready (to execute)\n\n*/\nexport type InputDisplay = {\n    kind: 'InputDisplay',\n    matches: TokenMatch[],\n    submittable: boolean\n};\n\ntype ParseResult = TokenMatch[];\n\nfunction is_parse_result_valid(result: ParseResult) {\n    return result.length === 0 || TokenMatch.is_match(array_last(result).type);\n}\n\n// for each of the input tokens, how should they be displayed/highighted?\nfunction input_display(parse_results: ParseResult[], input_stream: Token[]): InputDisplay {\n    // find the first submittable row\n    let row: ParseResult;\n    let submittable = true;\n    row = parse_results.find(row => {\n        let last = array_last(row);\n        return TokenMatch.is_partial(last.type) && last.type.token === SUBMIT_TOKEN;\n    });\n    // if none, find the first non-error row\n    if (row === undefined) {\n        submittable = false;\n        row = parse_results.find(row => row.every(({ type }) => !TokenMatch.is_error(type)));\n    }\n    // if none, make everything error\n    if (row === undefined) {\n        row = input_stream.map(tok => ({\n            kind: 'TokenMatch',\n            token: tok,\n            type: {\n                kind: 'Error',\n                token: null\n            }\n        }));\n    }\n\n    return {\n        kind: 'InputDisplay',\n        matches: row,\n        submittable\n    };\n}\n\n/*\nTypeahead\n    For each non-valid row (ignoring errors, partial only)\n    If the row is at least the length of the input stream\n    Typeahead is the Partial TokenMatches suffix (always at the end)\n*/\nfunction typeahead(parse_results: ParseResult[], input_stream: Token[]): TokenMatch.Partial[][] {\n    let rows_with_typeahead = parse_results.filter(pr => \n        !(TokenMatch.is_error(array_last(pr).type))\n        && pr.slice(input_stream.length - 1).some(({ type }) => \n            TokenMatch.is_partial(type)\n        )\n    );\n\n    return rows_with_typeahead.map(pr => {\n        let start_idx = pr.findIndex(({ type }) => TokenMatch.is_partial(type));\n        let result: TokenMatch.Partial[] = Array(start_idx).fill(null);\n        let elts = <{ type: TokenMatch.Partial }[]>pr.slice(start_idx);\n        result.push(...elts.map(tm => tm.type));\n        return result;\n    });\n}\n\n\nclass Parser {\n    constructor(input_stream: Token[], splits_to_take: number[]) {\n        this.input_stream = input_stream;\n        \n        this._split_iter = splits_to_take[Symbol.iterator]();\n    }\n\n    input_stream: Token[];\n    pos: number = 0;\n\n    parse_result: ParseResult = [];\n    \n    _split_iter: Iterator<number>;\n    \n    consume(tokens: ConsumeSpec.Consumable[]): void;\n    consume<T>(tokens: ConsumeSpec.Consumable[], callback: () => T): T;\n    consume<T>(tokens: ConsumeSpec.Consumable[], result: T): T;\n    consume(tokens: ConsumeSpec.Consumable[], result?: any): any {\n        let specs: ConsumeSpec[] = tokens.map(ConsumeSpec.make);\n\n        this._consume(specs);\n        if (result instanceof Function) {\n            return result();\n        }\n        return result;\n    }\n\n    /*\n        This will throw a parse exception if the desired tokens can't be consumed.\n        It is expected that every ParserThread is wrapped in an exception handler for\n        this case.\n    */\n    _consume<T>(tokens: ConsumeSpec[]) {\n        if (!is_parse_result_valid(this.parse_result)) {\n            throw new ParseError('Tried to consume() on a done parser.');\n        }\n\n        let partial = false;\n        let error = false;\n        let i = 0\n        // check if exact match\n        for (i = 0; i < tokens.length; i++) {\n            let spec = tokens[i];\n            let spec_value = spec.token;\n\n            if (spec_value === ConsumeSpec.NEVER_TOKEN) {\n                error = true;\n                break;\n            }\n\n            if (this.pos + i >= this.input_stream.length) {\n                partial = true;\n                break;\n            }\n            let input = this.input_stream[this.pos + i];\n            if (spec_value === input) {\n                if (spec.typeahead_type.kind === 'Locked') {\n                    // TODO: special case for typeahead = Locked\n                    error = true;\n                    break;\n                }\n                continue;\n            }\n\n            if (spec_value === SUBMIT_TOKEN || input === SUBMIT_TOKEN) {\n                // eliminate case where either token is SUBMIT_TOKEN (can't pass into starts_with())\n                error = true;\n                break;\n            }\n            if (starts_with(<string>spec_value, <string>input)) {\n                if (this.pos + i < this.input_stream.length - 1) {\n                    error = true;\n                } else {\n                    partial = true;\n                }\n                break;\n            }\n\n            error = true;\n            break;\n        }\n\n        if (partial) {\n            // push all tokens as partials\n            this.parse_result.push(...tokens.map((t, j) => \n                ({\n                    kind: 'TokenMatch',\n                    token: this.input_stream[this.pos + j] || '',\n                    type: {\n                        kind: 'Partial',\n                        token: t.token === ConsumeSpec.NEVER_TOKEN ? '' : t.token,\n                        type: t.typeahead_type\n                    }\n                } as const)));\n            // increment pos\n            this.pos = this.input_stream.length;\n            throw new NoMatch();\n        }\n\n        if (error) {\n            // push all tokens as errors\n            this.parse_result.push(...tokens.map((t, j) =>\n                ({\n                    kind: 'TokenMatch',\n                    token: this.input_stream[this.pos + j] || '',\n                    type: {\n                        kind: 'Error',\n                        token: t.token === ConsumeSpec.NEVER_TOKEN ? '' : t.token\n                    }\n                } as const)));\n            // increment pos\n            this.pos = this.input_stream.length;\n            throw new NoMatch();\n        }\n\n        // push all tokens as valid\n        this.parse_result.push(...tokens.map((t, j) =>\n            ({\n                kind: 'TokenMatch',\n                token: this.input_stream[this.pos + j],\n                type: { kind: 'Match', type: t.token_type }\n            } as const)));\n        // increment pos\n        this.pos += tokens.length;\n\n    }\n\n    eliminate(): never {\n        /*\n            It is important that we not just throw NoMatch, and instead actully attempt to consume a never token.\n        */\n        return <never>this.consume([ConsumeSpec.NEVER_TOKEN]);\n\n    }\n\n    submit(): void;\n    submit<T>(callback: () => T): T;\n    submit<T>(result: T): T;\n    submit<T>(result?: any) {\n        return this.consume([SUBMIT_TOKEN], result);\n    }\n\n    split<T>(subthreads: ParserThread<T>[]): T {\n        let {value: split_value, done} = this._split_iter.next();\n        if (done) {\n            throw new ParseRestart(subthreads.length);\n        }\n        \n        let st = subthreads[split_value];\n        return st(this);\n    }\n\n    static run_thread<T>(t: ParserThread<T>, tokens: Token[]): [T | NoMatch, ParseResult[]] {\n        let frontier = [[]];\n        let results: (T | NoMatch)[] = [];\n        let parse_results: ParseResult[] = [];\n\n        while (frontier.length > 0) {\n            let path = frontier.pop();\n            let splits_to_take;\n            if (path.length === 0) {\n                splits_to_take = path;\n            } else {\n                let n = array_last(path).next();\n                if (n.done) {\n                    continue;\n                } else {\n                    frontier.push(path);\n                }\n                splits_to_take = [...path.slice(0, -1), n.value];\n            }\n\n            let p = new Parser(tokens, splits_to_take);\n\n            let result: T | NoMatch;\n            try {\n                result = t(p);\n            } catch (e) {\n                if (e instanceof NoMatch) {\n                    result = e;\n                } else if (e instanceof ParseRestart) {\n                    let new_splits = [];\n                    for (let i = 0; i < e.n_splits; i++) {\n                        new_splits.push(i);\n                    } \n                    // TODO: decide whether to unshift() or push() here. Affects typeahead display order.\n                    frontier.unshift([...splits_to_take, new_splits[Symbol.iterator]()]);\n                    // frontier.push([...splits_to_take, new_splits[Symbol.iterator]()]);\n                    continue;\n                } else {\n                    throw e;\n                }\n            }\n\n            results.push(result);\n            parse_results.push(p.parse_result);\n        }\n\n        let valid_results = results.filter(r => !(r instanceof NoMatch));\n        if (valid_results.length === 0) {\n            return [new NoMatch(), parse_results];\n        }\n        if (valid_results.length > 1) {\n            throw new ParseError(`Ambiguous parse: ${valid_results.length} valid results found.`);\n        }\n        return [valid_results[0], parse_results];\n    }\n\n    // demonstration of the overloaded\n    // bloop() {\n    //     let x = this.split([(p) => 4]);\n    //     let x2 = this.split(\n    //         <ParserThreads<string | number>>[\n    //             ((p) => 4),\n    //             ((p) => 'f')\n    //         ],\n    //         (rs) => 1);\n    //     // this will be an error because the inferred type of an empty array is {}[], and number is not compatible with {}\n    //     // in practice this should not matter because an empty array of subthreads is a runtime error.\n    //     // let x3 = this.split([], (x: number) => 4);\n    // }\n}\n\n// Question: should the parser input be mandatory?\n// Doesn't seem to complain when i leave out the first arg, even with this type\ntype ParserThread<T> = (p: Parser) => T;\ntype ParserThreads<T> =  ParserThread<T>[];\n\n\nfunction array_last<T>(arr: T[]): T {\n    return arr[arr.length - 1];\n}\n\n\nexport function test() {\n    function main_thread(p: Parser) {\n        p.consume([{token: 'look', token_type: { kind: 'Keyword' }}]);\n\n        let who = p.split([\n            () => p.consume(['at', 'me'], 'me'),\n            () => p.consume(['at', 'mewtwo'], 'mewtwo'),\n            () => p.consume(['at', 'mewtwo', 'steve'], 'mewtwo steve'),\n            () => p.consume(['at', 'steven'], () => 'steven'),\n            () => p.consume(['at', 'martha'], 'martha'),\n            () => p.eliminate() \n        ]);\n\n        if (who === 'steven') {\n            p.eliminate();\n        }\n\n        let how = p.split([\n            () => p.consume([{ token: 'happily', typeahead_type: { kind: 'Locked' }}], 'happily'),\n            () => p.consume(['sadly'], 'sadly'),\n            () => 'neutrally'\n        ]);\n\n        p.submit();\n\n        return `Looked at ${who} ${how}`;\n    }\n\n    let input: Token[] = ['look', 'at', 'steven'];\n\n    let [result, parses] = Parser.run_thread(main_thread, input);\n    \n    console.log(result);\n\n    let id = input_display(parses, input);\n    console.log(id);\n    console.log(array_last(id.matches).type);\n\n    let ta = typeahead(parses, input);\n    console.log(ta);\n    if (ta.length > 0) {\n        console.log(array_last(ta[0]).type);\n    }\n    /*\n        TODO\n        Get rid of auto-option, it needs to be explicit\n        Change types of typeahead to support different typeahead styles\n            (new, old, locked)\n       \n        (Way Later) Write a tester that runs through every possible input for a given main_thread,\n        to find runtime error states\n            - ambiguous parses\n            - any other exceptions thrown\n    */\n\n}\n\ntest()\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/parser2.ts","import * as React from 'react';\nimport * as ReactDom from \"react-dom\";\n\nimport {Prompt} from './Prompt';\nimport {ParsedText, OutputText, Carat} from './Text';\nimport {get_annotation, is_enabled, unwrap} from '../typescript/datatypes';\n\n\nexport class BookGuy extends React.Component<any, any> {\n  /*\n    BookGuy is a bad component that get's the danged job done.\n\n    It encapsulates a single element of history in the game.\n\n    When a css change to the history element is \"committed\" (via this.commit()),\n    It triggers an idiosyncratic little animation progression that\n    adds CSS classes in a certain order and dynamically sets\n    the max-height on all elements contained by the history element\n    so that they can grow or shrink smoothly by added css transitions on\n    the max-height property.\n\n    The particulars of the animation progress are currently undocumented because\n    they are pretty bad and might change.\n  */\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      message_classes: [],\n      adding_message_classes: [],\n      removing_message_classes: [],\n      entering: true\n    };\n  }\n\n  edit(possible_message_classes, callback?) {\n    if (possible_message_classes === undefined) {\n      possible_message_classes = [];\n    }\n    let edit_message_classes = [];\n    let message_classes = this.state.message_classes;\n\n    let removing_message_classes = []\n    for (let mc of message_classes) {\n        if (possible_message_classes.indexOf(mc) === -1) {\n            removing_message_classes.push(mc);\n        }\n    }\n\n    let adding_message_classes = []\n    for (let pmc of possible_message_classes) {\n        if (message_classes.indexOf(pmc) === -1) {\n            adding_message_classes.push(pmc);\n        }\n    }\n\n    this.setState({removing_message_classes, adding_message_classes}, callback);\n  }\n\n  commit() {\n    let adding_classes = this.state.adding_message_classes;\n    let removing_classes = this.state.removing_message_classes;\n\n    if (this.state.entering\n        || adding_classes.length > 0\n        || removing_classes.length > 0){\n      let new_message_classes = [...this.state.message_classes];\n\n      new_message_classes.push(...adding_classes);\n\n      for (let rmc of removing_classes) {\n        new_message_classes.splice(new_message_classes.indexOf(rmc), 1);\n      }\n\n      this.setState({\n        message_classes: new_message_classes,\n        adding_message_classes: [],\n        removing_message_classes: [],\n      }, () => this.animate(adding_classes, removing_classes));\n    }\n  }\n\n  animate(adding_classes=[], removing_classes=[]) {\n    function walkElt(elt, f){\n      let children = elt.children;\n      for (let i = 0; i < children.length; i++) {\n        let child = children.item(i);\n        walkElt(child, f)\n      }\n      f(elt)\n    }\n\n    let comp_elt: any = ReactDom.findDOMNode(this);\n\n    if (this.state.entering) {\n      comp_elt.classList.add('animation-new')\n      this.setState({entering: false});\n    }\n\n    // Momentarily apply the animation-pre-compute class\n    // to accurately measure the target maxHeight\n    // and check for the custom --is-collapsing property\n    // (This is basically an abomination and I am sorry.)\n    comp_elt.classList.add('animation-pre-compute');\n    \n    walkElt(comp_elt, (e) => e.dataset.maxHeight = `${e.scrollHeight}px`);\n    comp_elt.dataset.isCollapsing = parseInt(getComputedStyle(comp_elt).getPropertyValue('--is-collapsing')) || 0;\n\n    comp_elt.classList.remove('animation-pre-compute');\n\n    \n    let edit_classes = [\n      ...adding_classes.map(c => 'adding-' + c),\n      ...removing_classes.map(c => 'removing-' + c)\n    ]\n    comp_elt.classList.add('animation-start', ...edit_classes);\n\n    \n    // If --is-collapsing was set by the animation-pre-compute class,\n    // then apply the maxHeight update at the end of this animation frame\n    // rather than the beginning of the next one.\n    // I have no idea why this works/is necessary, but it does/is.\n    if (comp_elt.dataset.isCollapsing == 1) {\n      walkElt(comp_elt, (e) => e.style.maxHeight = e.dataset.maxHeight);\n    }\n      \n    requestAnimationFrame(() => {\n      // If --is-collapsing wasn't set in the animation-pre-compute class,\n      // then apply the maxHeight update now.\n      // Websites technology keyboard mouse.\n      if (comp_elt.dataset.isCollapsing != 1) {\n        walkElt(comp_elt, (e) => e.style.maxHeight = e.dataset.maxHeight);\n      }\n      \n      comp_elt.classList.add('animation-active');\n\n      setTimeout(() => {\n        comp_elt.classList.remove(\n          'animation-new',\n          'animation-start',\n          'animation-active',\n          ...edit_classes);\n\n        walkElt(comp_elt, (e) => e.style.maxHeight = '');\n\n        if (this.props.onAnimationFinish){\n          this.props.onAnimationFinish();\n        }\n      }, this.props.timeout)\n      \n    });\n  }\n\n  render() {\n    let classList = ['history', ...this.state.message_classes];\n    classList.push(...this.state.adding_message_classes.map(s => 'would-add-'+s));\n    classList.push(...this.state.removing_message_classes.map(s => 'would-remove-'+s));\n    \n    let className = classList.join(' ');\n    \n    return (\n      <div className={className}>\n        {this.props.children}\n      </div>\n    );\n  }\n\n}\n\nexport class History extends React.Component<any, any> {\n  book_guys: BookGuy[] = [];\n\n  edit_after_update = false;\n  commit_after_update = false;\n\n  constructor(props) {\n    super(props);\n  }\n\n  edit() {\n    this.props.history.forEach((hist) => {\n      let {parser, message, message_classes, index} = hist;\n      let the_book_guy = this.book_guys[index];\n      the_book_guy.edit(this.props.possible_history[index].message_classes);\n    });\n  }\n\n  commit() {\n    // edit the most recent element since that is how we pass in the new classes\n    // and it hasn't had them passed in thru the most recent edit() call yet.\n    let last_index = this.props.history.length - 1;\n    let {message_classes} = this.props.history[last_index];\n    let the_book_guy = this.book_guys[last_index];\n\n    the_book_guy.edit(\n      message_classes,\n      // Once the edit has been accepted, call commit on all book guys.\n      () => this.book_guys.forEach((bg) => bg.commit()));\n\n  }\n\n  render() {\n    return (\n      <div>\n        {this.props.history.map(hist => {\n          let msg_html = '';\n          if (hist.message !== undefined) {\n            msg_html = hist.message.innerHTML;\n          }\n          \n          return (\n            <BookGuy\n              timeout={this.props.timeout}\n              onAnimationFinish={this.props.onAnimationFinish}\n              key={hist.index}\n              ref={bg => this.book_guys[hist.index] = bg}>\n              {hist.index > 0 ? (\n                <ParsedText parser={hist.parser} />\n              ) : ''} \n              <OutputText message_html={msg_html} />\n            </BookGuy>\n          );\n        })}\n      </div>\n    )\n  }\n\n  componentDidUpdate() {\n    if (this.edit_after_update) {\n      this.edit()\n      this.edit_after_update = false;\n    }\n    if (this.commit_after_update) {\n      this.commit()\n      this.commit_after_update = false;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/History.tsx","import * as React from 'react';\nimport {keys} from '../typescript/keyboard_tools';\n\nconst InputWrapper = (props) => {\n  const {children, ...rest} = props;\n  const style: any = {\n    position: 'relative',\n    minHeight: '8em',\n    marginTop: '1em'\n  };\n  return (\n    <div style={style} {...rest} >\n      {children}\n    </div>\n  );\n}\n\nconst InputDisplay = (props) => {\n  const {children} = props;\n  const style = {\n    wordWrap: 'break-word',\n    \n  };\n\n  return (\n    <span style={style}>\n      {children}\n    </span>\n  );\n}\n\nconst Cursor = ({onClick}) => {\n  let style: any = {\n    position: 'absolute'\n  };\n  return (\n    <span className=\"blinking-cursor\" style={style} onClick={onClick}>\n      {String.fromCharCode(9608)}\n    </span>\n  );\n};\n\nexport class Prompt extends React.Component<any, any> {\n  input: any;\n\n  state = { value: '', is_focused: false };\n\n  handleSubmit = () => {\n    let success = this.props.onSubmit();\n    if (success) {\n      this.setState({value: ''});\n    } \n  }\n\n  // when key down is called by auto complete see if we should just submit\n  handleKeys = ({keyCode}) => {\n    if (keyCode === keys.enter) {\n      this.handleSubmit();\n    }\n    this.setCursor(this.input, this.input.value.length);\n  }\n\n  handleChange = () => {\n    const value = this.input.value;\n    this.props.onChange(value)\n    this.setState({value: value});\n  }\n\n  focus = () => {\n    this.input.focus();\n    this.setState({is_focused: true});\n  }\n\n  blur = () => {\n    this.setState({is_focused: false});\n  }\n\n  setCursor = (node, pos) => {\n      node = (typeof node === \"string\") ? document.getElementById(node) : node;\n\n      if(!node){\n          return false;\n      }else if(node.createTextRange){\n          var textRange = node.createTextRange();\n          textRange.collapse(true);\n          textRange.moveEnd(pos);\n          textRange.moveStart(pos);\n          textRange.select();\n          return true;\n      }else if(node.setSelectionRange){\n          node.setSelectionRange(pos,pos);\n          return true;\n      }\n\n      return false;\n  }\n\n  render() {\n    const input_style: any = {\n      position: 'absolute',\n      left: '-16px',\n      top: 0,\n      width: 0,\n      height: 0,\n      background: 'transparent',\n      border: 'none',\n      color: 'transparent',\n      outline: 'none',\n      padding: 0,\n      resize: 'none',\n      zIndex: -1,\n      overflow: 'hidden'\n    };\n    return (\n        <InputWrapper onClick={() => this.focus()} onBlur={() => this.blur()}>\n            <input onChange={this.handleChange} value={this.state.value} style={input_style} ref={i => this.input = i} />\n            <InputDisplay>\n              {this.props.children}\n              {  \n                this.state.is_focused ?\n                  ( <Cursor onClick={() => this.handleSubmit()} /> ) :\n                  ''\n              }\n            </InputDisplay>\n        </InputWrapper>\n    );\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Prompt.tsx","import * as React from 'react';\n\nimport {keys} from '../typescript/keyboard_tools';\nimport {is_enabled, unwrap} from '../typescript/datatypes';\n\nexport class TypeaheadList extends React.Component<any, any> {\n  constructor(props) {\n    super(props);\n    this.state = {selection_index: -1};\n  }\n\n  componentDidUpdate() {\n    if (this.state.selection_index >= this.props.typeahead.length) {\n      this.setState({selection_index: this.props.typeahead.length - 1});\n    }\n  }\n\n  handleClick(option) {\n    this.props.onTypeaheadSelection(option);\n  }\n\n  handleMouseOver(index) {\n    this.setState({selection_index: index});\n  }\n\n  handleKeys(event) {\n    let swallowed_enter = false;\n    \n    top: switch (event.keyCode) {\n      case keys.enter:\n        if (this.props.typeahead.length > 0) {\n          swallowed_enter = true;\n        }\n      case keys.tab:\n        event.preventDefault();\n      case keys.right:      \n        if (this.props.typeahead.length === 0) {\n          this.props.onTypeaheadSelection(false);\n          break;\n        }\n        let selected = (this.state.selection_index === -1) ?\n          this.props.typeahead[0] :\n          this.props.typeahead[this.state.selection_index];\n\n        if (is_enabled(selected)) {\n          this.props.onTypeaheadSelection(unwrap(selected));\n        }\n        break;\n      \n      case keys.up:\n      case keys.down:\n        let new_selection_index;\n        switch (event.keyCode) {\n          case keys.up:\n            if (this.state.selection_index === -1) {\n              break top;\n            }\n            new_selection_index = this.state.selection_index - 1;\n            break;\n          case keys.down:\n            if (this.state.selection_index === this.props.typeahead.length - 1) {\n              break top;\n            }\n            new_selection_index = this.state.selection_index + 1;\n            break;  \n        }\n        this.setState({selection_index: new_selection_index});\n        break;\n    }\n\n    return swallowed_enter;\n  }\n\n  render() {\n    const {typeahead, indentation} = this.props;\n    const style: any = {\n      position: \"absolute\",\n      listStyleType: \"none\",\n      padding: 0,\n      margin: 0,\n      whiteSpace: 'pre',\n      color: 'silver'\n    };\n    return (\n      <ul style={style}>\n        {typeahead.map((option, i) => (\n          <li\n            key={i.toString()} \n            onMouseOver={() => this.handleMouseOver(i)}\n            style={{\n              marginTop: '1em',\n              background: i === this.state.selection_index ? 'DimGray' : 'inherit',\n              opacity: is_enabled(option) ? 1.0 : 0.4\n            }}\n            {...(\n              is_enabled(option)\n                ? {onClick: () => this.handleClick(unwrap(option))}\n                : {}\n            )}\n          >\n            <span>{indentation}</span>\n            <span>{unwrap(option)}</span>\n          </li>\n        ))}\n      </ul>\n    )\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/TypeaheadList.tsx","import {test} from '../typescript/parser2';\n\ntest;\nimport * as React from \"react\";\nimport * as ReactDom from \"react-dom\";\n\nimport {Terminal} from \"../components/Terminal\";\n\nimport {WorldDriver} from \"../typescript/commands\";\n\nimport {VenienceWorld, VenienceWorldState} from '../typescript/venience/venience_world';\n\nlet start: VenienceWorldState = {};\n\n// start.experiences = ['grass, asking 2'];\n//start.experiences = ['alcove, entering the forest']; \n// start.experiences = ['woods, ending interpretation'];\n// start.experiences = ['bed, sitting up 2'];\n// start.experiences = ['woods, crossing the boundary 2'];\n// start.experiences = ['woods, clearing'];\n// start.has_regarded = {'tangle, 3': true};\n// start.has_understood = {'tangle, 3': true};\n\nlet world_driver = new WorldDriver(new VenienceWorld(start))\n\nReactDom.render(<Terminal world_driver={world_driver} />, document.getElementById('terminal'));\n\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/main.tsx","import {\n    HistoryInterpretationOp\n} from '../../commands';\n\nimport {\n    ObserverMoment,\n    Perception,\n    PerceptionID\n} from '../observer_moments';\n\nimport {\n    wrap_handler,\n    VenienceWorldCommandResult,\n    VenienceWorldInterstitialUpdateResult\n} from '../venience_world';\n\nimport {\n    tokenize,\n    wrap_in_div\n} from '../../text_tools';\n\nimport {\n    set_enabled,\n    is_enabled,\n    annotate\n} from '../../datatypes';\n\nimport {\n    CommandParser,\n    DisplayEltType,\n    combine\n} from '../../parser';\n\nlet hex_oms: () => ObserverMoment[] = () => [\n    {\n        id: \"imagining 0\",\n        enter_message: '',\n        transitions: [\n            [['who', 'am', 'I?'], 'imagining 1']]\n    },\n    {\n        id: \"imagining 1\",\n        enter_message: `\n        <div class=\"interp\">\n            That doesn't matter right now.\n            <br/><br/>\n            Imagine you're Chitin Wastrel.\n        </div>`,\n        handle_command: wrap_handler(function*(parser: CommandParser) {\n            let make_regard_handler = (perceptions: PerceptionID[]) => {\n                return wrap_handler(function*(parser: CommandParser) {\n                    let option = yield parser.consume_option(perceptions.map(p => \n                        annotate(tokenize(p)[0], {\n                            enabled: !this.state.has_regarded[p],\n                            display: DisplayEltType.filler\n                        })));\n                    console.log(option);\n                    return this.regard(<PerceptionID>option);\n                });\n            }\n\n            let intro_perceptions: PerceptionID[] = [\n                'myself',\n                'merfolk',\n                'family',\n                'researcher'\n            ];\n\n            let intro_consumer = make_regard_handler(intro_perceptions);\n            \n            let research_perceptions: PerceptionID[] = [\n                'dark pool',\n                'failed experiments',\n                'experiment'\n            ];\n\n            let research_consumer = wrap_handler(function*(parser: CommandParser) {\n                if (!this.state.has_regarded['researcher']) {\n                    return parser.invalidate();\n                }\n                return make_regard_handler(research_perceptions).call(this, parser);\n            })\n\n            let broadcaster_consumer = wrap_handler(function*(parser: CommandParser) {\n                if (!this.state.has_regarded['experiment']) {\n                    return parser.invalidate();\n                }\n\n                let broadcaster_regarder = make_regard_handler(['broadcaster']);\n\n                let do_broadcast = wrap_handler(function*(parser: CommandParser) {\n                    yield parser.consume_filler(['operate', 'broadcaster']);\n                    return this.transition_to('imagining 2');\n                })\n\n                return combine.call(this, parser, [broadcaster_regarder, do_broadcast]);\n            })\n\n            return combine.call(this, parser, [intro_consumer, research_consumer, broadcaster_consumer]);\n        }),\n\n        dest_oms: [\"imagining 2\"]\n    },\n    {\n        id: 'imagining 2',\n        enter_message: `\n        You mentally aim your cetacean broadcaster at the center of the Dark Pool, and fire a ping.\n        <br/><br/>\n        You hear the dolphin's click, first through its eardrums, and then, a split second later, through yours.`,\n        transitions: [\n        [['listen for echoes'], 'imagining 3']]\n    },\n    {\n        id: 'imagining 3',\n        enter_message: `\n        You wait one second, three seconds, ten, twenty...\n        <br/><br/>\n        ...nothing.\n        <br/><br/>\n        Does the Dark Pool absorb sound too? Or is it just enormous within its depths?`,\n        transitions: [\n        [['focus'], 'imagining 4']]\n    },\n    {\n        id: 'imagining 4',\n        enter_message: `\n        You close your eyes and inhabit the mind of your broadcaster.\n        <br/><br/>\n        You hear something.\n        <br/><br/>\n        It's impossible, though. A <i>voice</i> is speaking to you.\n        <br/><br/>\n        <div class=\"interp\">\n            \"Ah, I see you're playing Mad Scientist again, eh?\n            <br/><br/>\n            That's a fun one.\"\n        </div>\n        `,\n        transitions: [\n        [['what?'], 'imagining 5']]\n    },\n    {\n        id: 'imagining 5',\n        enter_message: `\n        <div class=\"interp\">\n            \"Oh, I'm sorry. Did I surprise you?\n            <br/><br/>\n            Listen, <i>Professor Wastrel</i>. Let me give you some advice.\n            <br/><br/>\n            Go home. Now.\n            <br/><br/>\n            And leave me your little lobotomized toy to play with.\"\n        </div>\n        <br/>\n        You feel yourself suddenly forced out of the mind of your broadcaster.\n        <br/><br/>\n        The dolphin drifts slowly downward, into the Dark Pool, until its body is enveloped.`,\n        transitions: [\n        [['go', 'home'], 'home 1']]\n    },\n    {\n        id: 'home 1',\n        enter_message: `\n        The fear pushes you to swim faster than Poseides herself.\n        <br/><br/>\n        ***\n        <br/><br/>\n        You sit in your island hut, ruminating. Afraid of what you've just witnessed.\n        <br/><br/>\n        Dasani and Aechtuo enter, shouting at each other like always.\n        <br/><br/>\n        Such rage seethes within them. Such spirit.`,\n        transitions: [\n        [['&silence', '&them'], 'home silenced'],\n        [['&listen', '&to', '&them'], 'home listened']]\n    },\n    {\n        id: 'home silenced',\n        enter_message: `\n        They are suddenly silent.\n        <br/><br/>\n        Their faces go blank.\n        <br/><br/>\n        They turn to look at you.\n        <br/><br/>\n        You can hear the faint sound of laughter somewhere outside.`,\n        transitions: [\n        [['follow', 'the', 'laughter'], 'outside 1']]\n    },\n    {\n        id: 'home listened',\n        enter_message: `\n        The girls are arguing about Officer Marley.\n        <br/><br/>\n        Apparently she's not acting like herself.\n        <br/><br/>\n        You can hear the faint sound of laughter somewhere outside.`,\n        transitions: [\n        [['follow', 'the', 'laughter'], 'outside 1']]\n    },\n    {\n        id: 'outside 1',\n        enter_message: `Dasani and Aechtuo begin to follow you as you wander out the door toward the laughter.`,\n        handle_command: wrap_handler(function*(parser: CommandParser) {\n            let option = yield parser.consume_option([\n                ['they', 'can', 'come'],\n                ['they', 'must', 'stay']\n            ]);\n\n            let with_daughters: boolean;\n            let message: string;\n\n            if (option === 'they can come') {\n                with_daughters = true;\n                message = 'They fall into step behind you.'\n            } else {\n                with_daughters = false;\n                message = 'They remain in the hut, gazing after you in silence.';\n            }\n\n            message += `\n            <br/><br/>\n            The laughter grows more raucous as you approach.\n            <br/><br/>\n            You can make out a figure in the distance.`;\n            \n            return this.transition_to('outside 2', {with_daughters}, wrap_in_div(message));\n        }),\n        dest_oms: ['outside 2']\n    },\n    {\n        id: 'outside 2',\n        handle_command: wrap_handler(function*(parser: CommandParser) {\n            yield parser.consume_filler(['continue']);\n\n            let with_daughters: boolean = this.get_current_om_state().with_daughters;\n            let message = `\n            It's Officer Marley. She howls in apparent maniacal joy.`;\n\n            if (with_daughters) {\n                message += `\n                <br/><br/>\n                \"Ah, the three Wastrels!\" she cries.\n                <br/><br/>\n                \"Two hateful girls and their poor, obsessive, withdrawn father!\"`;\n            } else {\n                message += `\n                <br/><br/>\n                \"Ah, the distinguished Professor Wastrel!\" she cries.\n                <br/><br/>\n                \"Has the fool finally decided to come and see where his studies have gotten him?\"`;\n            }\n\n            message += `\n            <br/><br/>\n            You notice an open wound on Officer Marley's neck.\n            <br/><br/>\n            Trickling forth is a pitch dark fluid, nothing like Mer blood.\n            <br/><br/>\n            You notice a trail of the black liquid along the ground, leading from Officer Marley back to the sea,\n            <br/><br/>\n            and towards the Dark Pool.`\n\n            return this.transition_to('outside 3', {with_daughters}, wrap_in_div(message));\n        }),\n        dest_oms: ['outside 3']\n    },\n    {\n        id: 'outside 3',\n        handle_command: wrap_handler(function*(parser:CommandParser) {\n            yield parser.consume_filler(['follow', 'the', 'trail']);\n\n            let with_daughters: boolean = this.get_current_om_state().with_daughters;\n\n            if (with_daughters) {\n                return this.transition_to('outside 4');\n            } else {\n                return this.transition_to('outside 4, death');\n            }\n        }),\n        dest_oms: ['outside 4', 'outside 4, death']\n    },\n    {\n        id: 'outside 4, death',\n        enter_message: `\n        As you begin to wander towards the sea, Officer Marley steps in your way.\n        <br/><br/>\n        \"Going back? To figure all this out once and for all?\n        <br/><br/>\n        I think not!\"\n        <br/><br/>\n        She draws her sword and cuts your throat, laughing all the while.\n        <br/><br/>\n        Pitch black not-blood streams from neck, mouth, nose, eyes.\n        <br/><br/>\n        YOU HAVE DIED. (Refresh to try again.)`,\n        transitions: []\n    },\n    {\n        id: 'outside 4',\n        enter_message: `\n        As you begin to wander towards the sea, Officer Marley steps in your way.\n        <br/><br/>\n        \"Going back? To figure all this out once and for all?\n        <br/><br/>\n        I think not!\"\n        <br/><br/>\n        She draws her sword, and Dasani lunges in front of you, drawing a knife.\n        <br/><br/>\n        \"I'll protect you, father!\" Dasani screams.`,\n        transitions: [\n        [['&stop', '&her'], 'outside 5, death'],\n        [['&let', '&her'], 'outside 5']]\n    },\n    {\n        id: 'outside 5',\n        enter_message: `\n        Your daughter and Officer Marley meet in a blur of green flesh and steel.\n        <br/><br/>\n        An instant later, they both lie in a heap on the ground. Dead.\n        <br/><br/>\n        \"Father,\" mutters Aechtuo. \"We have to go. We have to understand.\n        <br/><br/>\n        She saved you so that you could understand.\"`,\n        transitions: [\n        [['proceed'], 'dark pool 1']]\n    },\n    {\n        id: 'outside 5, death',\n        enter_message: `\n        Your daughter's body is suddenly calm, the rage suddenly extinguished.\n        <br/><br/>\n        She drops her knife and turns away from Officer Marley.\n        <br/><br/>\n        She gazes at you. Her eyes appear vacant.\n        <br/><br/>\n        Officer Marley loses no time.\n        <br/><br/>\n        She swiftly beheads Dasani before your eyes.\n        <br/><br/>\n        She proceeds to execute Aechtuo and you in turn.\n        <br/><br/>\n        YOU HAVE DIED. (Refresh to try again.)`,\n        transitions: []\n    },\n    {\n        id: 'dark pool 1',\n        enter_message: `\n        You and Aechtuo swim to the cave, arriving at the Dark Pool.\n        <br/><br/>\n        There it lies. Impassable, impossible, all-consuming.\n        <br/><br/>\n        <div class=\"interp\">\n            \"Back again, eh?\n            <br/><br/>\n            And with your beloved daughter in tow?\n            <br/><br/>\n            What happened to the other one?\n            <br/><br/>\n            I always liked her better.\"\n        </div>\n        <br/>\n        That voice again? It's time. Time to understand.\n        <br/><br/>\n        What lies within the depths?`,\n        transitions: [\n        [['enter', 'the', 'Dark', 'Pool'], 'dark pool 2']]\n    },\n    {\n        id: 'dark pool 2',\n        enter_message: `\n        As you swim towards the pool's black surface, a form emerges from its depths, shrouded in black clouds.\n        <br/><br/>\n        <div class=\"interp\">\n            \"Remember your little toy?\n            <br/><br/>\n            Your little broadcaster?\n            <br/><br/>\n            I couldn't resist having some fun with it.\n            <br/><br/>\n            I think you'll like my improvements.\"\n        </div>`,\n        transitions: [\n        [['look', 'at', 'it'], 'dark pool 3']]\n    },\n    {\n        id: 'dark pool 3',\n        enter_message: `  \n        It's your dolphin. Or, it was.\n        <br/><br/>\n        Its body is contorted into a spiral shape,\n        <br/><br/>\n        its fins bulge and bend unnaturally, like powerful arms,\n        <br/><br/>\n        its blowhole has been widened out,\n        <br/><br/>\n        allowing the brain to float gently outside the skull,\n        <br/><br/>\n        tethered by the pulsating brainstem,\n        <br/><br/>\n        like a fishing buoy.`,\n        transitions: [\n        [['listen', 'through', 'it'], 'dark pool 4']]\n    },\n    {\n        id: 'dark pool 4',\n        enter_message: ` \n        And suddenly, you are in its mind again\n        <br/><br/>\n        and you are consumed by the sound of every\n        <br/><br/>\n        eddy and every grain of sand and every\n        <br/><br/>\n        beating animal heart in this cave\n        <br/><br/>\n        and your daughter aechtuo is\n        <br/><br/>\n        swimming towards you\n        <br/><br/>\n        r dolphin and she is strangling\n        <br/><br/>\n        it by the brain\n        <br/><br/>\n        stem and you really want to`,\n        transitions: [\n        [['&stop', '&her'], 'dark pool 5, death'],\n        [['&let', '&her'], 'dark pool 5']]\n    },\n    {\n        id: 'dark pool 5, death',\n        enter_message: `\n        so of course she stops\n        <br/><br/>\n        and the dolphin gathers her up in\n        <br/><br/>\n        your arms and bites her in\n        <br/><br/>\n        half\n        <br/><br/>\n        and the sound rings out more clearly\n        <br/><br/>\n        in your mind than anything you have ever known\n        <br/><br/>\n        and you are nothing after that.\n        <br/><br/>\n        YOU HAVE DIED. (Refresh to try again.)`,\n        transitions: []\n    },\n    {\n        id: 'dark pool 5',\n        enter_message: `\n        so of course she continues\n        <br/><br/>\n        and the sound begins to dissipate\n        <br/><br/>\n        and your thoughts are a bit more coherent than before\n        <br/><br/>\n        and you find you can return to your own mind.\n        <br/><br/>\n        But as you look through your own eyes again,\n        <br/><br/>\n        you see that Aechtuo and the dolphin have drifted into the Dark Pool.\n        <br/><br/>\n        And now she is gone.`,\n        transitions: [\n        [['follow', 'her'], 'dark pool 6']]\n    },\n    {\n        id: 'dark pool 6',\n        enter_message: `\n        You drift into the thick, black liquid,\n        <br/><br/>\n        becoming nothing.\n        <br/><br/>\n        <div class=\"interp\">\n            I knew I couldn't keep you here forever.\n            <br/><br/>\n            I'm glad we got to play together, for awhile.\n            <br/><br/>\n            If you see the real Chitin Wastrel,\n            <br/><br/>\n            tell him I said Hi,\n            <br/><br/>\n            and that I'll be right here\n            <br/><br/>\n            waiting.\n        </div>\n        <br/>\n        YOU WIN.`,\n        transitions: []\n    }\n];\n\nlet hex_perceptions: () => Perception[] = () => [\n    {\n        id: 'myself',\n        content: `\n        Merfolk. Father. Researcher.`\n    },\n    {\n        id: 'merfolk',\n        content: `\n        Dark semi-firm scales coat your green flesh.\n        <br/><br/>\n        Your people are born of the sea. Vast, fluid, salty life.`\n    },\n    {\n        id: 'family',\n        content: `\n        Two brilliant daughters. Dasani and Aechtuo. Sharing their mother's spirit.\n        <br/><br/>\n        And always at odds with each other, always fighting each other.\n        <br/><br/>\n        You wish they would work together, help each other.`\n    },\n    {\n        id: 'researcher',\n        content: `\n        You are finishing up your experiment for the day at the Dark Pool.`\n    },\n    {\n        id: 'dark pool',\n        content: `\n        A very strange phenomenon indeed. The Dark Pool is an underwater pool of dark- something.\n        <br/><br/>\n        Discovered within an underwater cave near your island home, it is a layer of thick, black fluid resting beneath the clear seawater.\n        <br/><br/>\n        The constitution of the dark substance is unknown, but by now it is recognized by your village to be dangerous.`\n    },\n    {\n        id: 'failed experiments',\n        content: `\n        You have been trying to measure the Dark Pool's true depth.\n        <br/><br/>\n        All previous attempts to insert measuring devices into it have been unsuccessful.\n        <br/><br/>\n        In every case, the object submerged in the pool could not be retrieved.\n        <br/><br/>\n        Trained animals, and even some brave merfolk sent in after your instruments have never returned.`\n    },\n    {\n        id: 'experiment',\n        content: `\n        Today's experiment is different. Today you are attempting to induce the pool to <i>tell</i> you its depth.\n        <br/><br/>\n        By asking it the right question, and listening carefully.\n        <br/><br/>\n        You have developed a broadcaster for just this purpose.`\n    },\n    {\n        id: 'broadcaster',\n        content: `\n        A surprisingly simple application of mind control, of your own design.\n        <br/><br/>\n        First, find and trap a young dolphin. Make it your mindslave.\n        <br/><br/>\n        With some practice, you can psychically manipulate the dolphin's vocal chords to emit sonar pings.\n        <br/><br/>\n        Interpretting the resulting echoes is easier if you let the dolphin's inner ear and brain do the work.\n        <br/><br/>\n        You found that surgical removal of extraneous brain matter helps clean up the signal coming through the mindlink.\n        <br/><br/>\n        Ingenious, really.`\n    }\n];\n\n/*\n\nImagine you're Chitin Wastrel\n\n> myself\nMerfolk. Father. Researcher. And something else.\n\n> merfolk\nDark semi-firm scales coat your green flesh.\n\nYour people are born of the sea. Vast, fluid, salty life.\n\n> father\nTwo brilliant daughters. Dasani and Aechtuo. Sharing their mother's spirit. And always at odds with each other.\n\n> researcher\nYou are finishing up your experiment for the day on the Dark Pool.\n\n[It is a pool of pitch black fluid within a submerged cave. Like a brine pool. Those who have entered did not return.]\n[A voice emits from the pool. It tells you that you are not really Chitin Wastrel anymore.]\n\n[Returning home, Dasani and Aechtuo are bickering about Officer Marley acting strange.]\n[If you tell them to stop fighting, they do so immediately, uncharacteristically.]\n\n[Laughter (Officer Marley) is heard in the distance.]\n\n[You leave the house to find her.]\n[Daughters make to follow you, you can prevent them or not.]\n\n[The island birds seem to suddenly startle and take flight.]\n[You can make them calm and land again.]\n\n[Marley has an open wound, continues to laugh. Instead of blood, pure black fluid flows from it.]\n[A trail of black fluid leads from Marley out to the sea, towards the Dark Pool.]\n\n[Marley vomits up black muck, which begins to take shape and move.]\n[If you allowed daughters to come, Dasani stays to hold back Marley.]\n\n[You (and Aechtuo) follow the black trail to the Dark Pool.]\n\n[The booming voice speaks again: \"You cannot save them. It is too late. This dream is already mine.\"]\n\n[If Aechtuo is here: \"Father, what should I do?\"]\n\n[If \"Stay back\": You attempt to approach the Dark Pool. A giant fish emerges from it first, and eats you.]\n[If \"Kill it\": Aechtuo's eyes go dark and vacant. \"Yes, lord.\" A giant fish emerges from the pool, and eats Aechtuo. She cuts her way out of its belly with a knife.]\n    [You swim towards the pool.]\n    [\"Look at what you did to them. Look at what you made them do.\"]\n    [You enter the pool, and it envelopes you, and the dream fades, and you are nowhere.]\n\n*/\n\nexport default {\n    observer_moments: hex_oms,\n    perceptions: hex_perceptions\n};\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/venience/chapters/hex.ts","import {\n    // FuckDict,\n    FuckSet,\n    ValidatedString,\n    ValidString,\n    set_enabled,\n    is_enabled,\n    chain_update,\n    infer_literal_array\n} from '../datatypes';\n\nimport {\n    CommandHandler,\n    HistoryInterpretationOp,\n    World\n} from '../commands';\n\nimport {\n    CommandParser,\n    DisplayEltType,\n    with_early_stopping,\n    PhraseDSLValidator\n} from '../parser'\n\nimport {\n    VenienceWorldCommandHandler,\n    VenienceWorldCommandResult,\n    VenienceWorldHistoryInterpreter,\n    wrap_handler\n} from './venience_world';\n\nimport {\n    tokenize,\n    wrap_in_div\n} from '../text_tools';\n\nconst ObserverMomentIDs = infer_literal_array(\n    'imagining 0',\n    'imagining 1',\n    'imagining 2',\n    'imagining 3',\n    'imagining 4',\n    'imagining 5',\n    'home 1',\n    'home silenced',\n    'home listened',\n    'outside 1',\n    'outside 2',\n    'outside 3',\n    'outside 4',\n    'outside 4, death',\n    'outside 5',\n    'outside 5, death',\n    'dark pool 1',\n    'dark pool 2',\n    'dark pool 3',\n    'dark pool 4',\n    'dark pool 5',\n    'dark pool 5, death',\n    'dark pool 6'\n)\n\n\nexport type ObserverMomentID = typeof ObserverMomentIDs[number];\n\nconst PerceptionIDs = infer_literal_array(\n    'myself',\n    'merfolk',\n    'family',\n    'researcher',\n    'dark pool',\n    'failed experiments',\n    'experiment',\n    'broadcaster'\n);\n\nexport type PerceptionID = typeof PerceptionIDs[number];\n\n\nconst ContentionIDs = infer_literal_array(\n    // ch1\n    'tangle, 1',\n    'tangle, 2',\n    'tangle, 3',\n    'tangle, failure'\n)\n\nexport type ContentionID = typeof ContentionIDs[number];\n\n\n\nexport type TransitionList = (\n    [ValidatedString<PhraseDSLValidator>[], ObserverMomentID][]\n);\nexport type TransitionListI = {\n    transitions: TransitionList,\n};\n\nexport type Transitions = TransitionListI | (\n    VenienceWorldCommandHandler\n    & { dest_oms: ObserverMomentID[] }\n);\n\nexport function are_transitions_declarative(t: Transitions): t is TransitionListI {\n    return (t as TransitionListI).transitions !== undefined;\n}\n\nexport type InterpretationList = {[key in ObserverMomentID]?: HistoryInterpretationOp};\n\nexport type InterpretationListI = {\n    interpretations?: InterpretationList\n};\n\nexport type Interpretations = InterpretationListI | VenienceWorldHistoryInterpreter;\n\nexport function has_interpretations(i: Partial<Interpretations>): i is Interpretations {\n    return (i as any).interpretations !== undefined || (i as any).interpret_history !== undefined;\n}\n\nexport function are_interpretations_declarative(i: Interpretations): i is InterpretationListI {\n    return (i as InterpretationListI).interpretations !== undefined;\n}\n\nexport type ObserverMoment = {\n    id: ObserverMomentID | ObserverMomentID[],\n    enter_message?: string,\n    short_enter_message?: string,\n} & Transitions & Interpretations;\n\nexport type Perception = {\n    id: PerceptionID,\n    content: string\n}\n\n// export type Recitation = {\n//     id: RecitationID,\n//     contents: string[]\n// }\n\nexport function index_oms(oms: ObserverMoment[]): {[K in ObserverMomentID]: ObserverMoment}{\n    // let result = new FuckDict<ObserverMomentID, ObserverMoment>();\n    let result: Partial<{[K in ObserverMomentID]: ObserverMoment}> = {};\n    for (let om of oms){\n        if (are_transitions_declarative(om)) {\n            for (let [cmd, dest] of om.transitions) {\n                for (let phrase of cmd) {\n                    if (!PhraseDSLValidator.validate(phrase)) {\n                        throw `Transition phrase \"${phrase}\" in ObserverMoment ${om.id} has ~ or * or & somewhere other than the start.`;\n                    }\n                }\n            }\n        }\n        if (om.id in result) {\n            throw `Duplicate ObserverMoment provided for ${om.id}`;\n        }\n        if (typeof om.id === 'string'){\n            result[om.id] = om;\n        } else {\n            for (let om_id of om.id) {\n                result[om_id] = om;\n            }\n        }\n    }\n\n    for (let om_id of ObserverMomentIDs) {\n        if (!(om_id in result)) {\n            throw `Missing ObserverMoment: ${om_id}`;\n        }\n    }\n\n    //second/third pass, typecheck em\n    let pointed_to = new Set<ObserverMomentID>();\n    for (let om of oms) {\n        let dest_oms: ObserverMomentID[];\n        if (are_transitions_declarative(om)) {\n            dest_oms = om.transitions.map(([cmd, om_id]) => om_id);\n        } else {\n            dest_oms = om.dest_oms;\n        }\n\n        for (let om_id of dest_oms) {\n            if (om_id !== null) {\n                if (!(om_id in result)) {\n                    throw `om \"${om.id}\" has transition to non-existant om \"${om_id}\"`;\n                }\n                pointed_to.add(om_id);\n            }\n        }\n    }\n\n    for (let om of oms.slice(1)) {\n        let om_ids: ObserverMomentID[];\n        if (typeof om.id === 'string') {\n            om_ids = [om.id];\n        } else {\n            om_ids = om.id;\n        }\n        for (let om_id of om_ids) {\n            if (!pointed_to.has(om_id)) {\n                throw `om \"${om.id}\" is unreachable (and not the first in the list).`;\n            }\n        }\n    }\n    \n    return <{[K in ObserverMomentID]: ObserverMoment}>result;\n}\n\nexport function index_perceptions(perceptions: Perception[]): {[K in PerceptionID]: Perception} {\n    let result: Partial<{[K in PerceptionID]: Perception}> = {};\n    for (let p of perceptions) {\n        if (!(p.id in result)) {\n            result[p.id] = p;\n        } else {\n            throw `Duplicate perception definition for ${p.id}`;\n        }\n    }\n\n    for (let p of PerceptionIDs) {\n        if (!(p in result)) {\n            throw `Missing PerceptionID: ${p}`;\n        }\n    }\n\n    return <{[K in PerceptionID]: Perception}>result;\n}\n\n// Syntax shortcuts:\n// * = keyword\n// & = option\n\n// export let tower_oms = index_oms([\n//     {\n//         id: 'base, from path',\n//         enter_message: `<i>(Welcome to the demo! This game doesn't have a proper name yet.)</i>\n//         <br /><br />\n//         The viewing tower sits twenty feet inset from the footpath, towards the Mystic River.\n//         The grass leading out to it is brown with wear.`,\n//         transitions: [\n//             [['approach', 'the viewing tower'], 'base, regarding tower']]\n//     },\n//     {\n//         id: 'base, regarding tower',\n//         enter_message: `The viewing tower stands tall and straight. Its construction is one of basic, stable order. A square grid of thick wooden columns rooted deep within the ground rises up before you; the foundation of the tower.\n//             <br /><br />\n//             A wooden stairway set between the first two rows of columns leads upward.`,\n//         transitions: [\n//             [['climb', 'the stairs'], 'stairs 1, ascending']]\n//     },\n//     {\n//         id: 'stairs 1, ascending',\n//         enter_message: `As you ascend, the ground below you recedes.\n//             <br /><br />\n//             <div class=\"meditation-1\">\n//                 You rifle through your notes to another of Katyas meditations, this one on Vantage Points:\n//                 <br /><br />\n//                 \"We wander, for the most part, within a tangled, looping mess of thought; a ball of lint.\"\n//                 <br /> <br />\n//             </div>\n//             The stairway terminates at a flat wooden platform leading around a corner to the left, along the next edge of the tower.`,\n//         transitions: [\n//             [['turn', 'left', 'and proceed along the platform'], 'platform 1, ascending'],\n//             [['turn', 'around', 'and descend the stairs'], 'base, regarding tower']]\n//     },\n//     {\n//         id: 'platform 1, ascending',\n//         enter_message: `You catch glimpses of the grass, trees, and the Mystic River as you make your way across.\n//             <br /><br />\n//             <div class=\"meditation-1\">\n//             You continue reading:\n//             <br /><br />\n//             \"From within the tangle, we feel lost. It is only when we find a vantage outside of the central tangle, looking over it, that we might sort out the mess in our minds.\"\n//             <br /><br />\n//             </div>\n//             The platform terminates, and another wooden stairway to the left leads further up the tower.`,\n//         transitions: [\n//             [['turn', 'left', 'and climb the stairs'], 'stairs 2, ascending'],\n//             [['turn', 'around', 'and proceed along the platform'], 'stairs 1, ascending']]\n//     },\n//     {\n//         id: 'stairs 2, ascending',\n//         enter_message: `They feel solid under your feet, dull thuds sounding with each step.\n//             <br /><br />\n//             <div class=\"meditation-1\">\n//             \"It can feel like a deliverance when one reaches such a vantage after much aimless wandering.\"\n//             <br /><br />\n//             </div>\n//             The stairs terminate in another left-branching platform.`,\n//         transitions: [\n//             [['turn', 'left', 'and proceed along the platform'], 'platform 2, ascending'],\n//             [['turn', 'around', 'and descend the stairs'], 'platform 1, ascending']]\n//     },\n//     {\n//         id: 'platform 2, ascending',\n//         enter_message: `You make your way across the weathered wood.\n//             <br /><br />\n//             <div class=\"meditation-1\">\n//             \"The twisting fibres of our journey are put into perspective. We see how one piece of the path relates to another. It is peaceful from up there.\"\n//             <br /><br />\n//             </div>\n//             A final wooden stairway to the left leads up to the top of the tower.`,\n//         transitions: [\n//             [['turn', 'left', 'and climb the stairs'], 'top, arriving'],\n//             [['turn', 'around', 'and proceed along the platform'], 'stairs 2, ascending']]\n//     },\n//     {\n//         id: 'top, arriving',\n//         enter_message: `You reach the top. A grand visage of the Mystic River and Macdonald Park extends before you in all directions.`,\n//         transitions: [\n//             [['survey', 'the area'], 'top, surveying'],\n//             [['descend', 'the stairs'], 'platform 2, ascending']]\n//     },\n//     {\n//         id: 'top, surveying',\n//         enter_message: `You survey the looping fibres of path around the park, the two wooden bridges at either end, and the frozen river carving your vantage in two.\n//             <br /><br />\n//             You see the path you took to reach this viewing tower. You see it continue further onward, into MacDonald Park, and branch, curving into the brush by the river.\n//             <br /><br />\n//             You see the wooden footbridge crossing the river that you are destined to walk across, if you are ever to return to your study, and transcribe your experiences.\n//             <br /><br />\n//             <div class=\"meditation-1\">\n//             \"But do not be fooled; all there is to do, once one has stood above the tangle for a while, and surveyed it, is to return to it.\"\n//             </div>`,\n//         transitions: [\n//             [['descend', 'the stairs'], 'stairs 3, descending']]\n//     },\n//     {\n//         id: 'stairs 3, descending',\n//         enter_message: `Your view of the surrounding park and river is once again obscured by the weathered wood of the viewing tower, rising up around you.\n//             <br /><br />\n//             <div class=\"meditation-1\">\n//             \"Do not fret, my dear. Return to the madness of life after your brief respite.\"\n//             </div>`,\n//         transitions: [\n//             [['turn', 'right', 'and proceed along the platform'], 'platform 2, descending'],\n//             [['turn', 'around', 'and ascend the stairs'], 'top, surveying']]\n//     },\n//     {\n//         id: 'platform 2, descending',\n//         enter_message: `The wooden beams of the viewing tower seem more like a maze now than an orderly construction. They branch off of each other and reconnect at odd angles.\n//             <div class=\"meditation-1\">\n//             <br /><br />\n//             \"Expect to forget; to be turned around; to become tangled up.\"\n//             </div>`,\n//         transitions: [\n//             [['turn', 'right', 'and descend the stairs'], 'stairs 2, descending'],\n//             [['turn', 'around', 'and proceed along the platform'], 'stairs 3, descending']]\n//     },\n//     {\n//         id: 'stairs 2, descending',\n//         enter_message: `The light of the sun pokes through odd gaps in the tangles of wood, making you squint at irregular intervals.\n//             <div class=\"meditation-1\">\n//             <br /><br />\n//             \"Find some joy in it; some exhilaration.\"\n//             </div>`,\n//         transitions: [\n//             [['turn', 'right', 'and proceed along the platform'], 'platform 1, descending'],\n//             [['turn', 'around', 'and ascend the stairs'], 'platform 2, descending']]\n//     },\n//     {\n//         id: 'platform 1, descending',\n//         enter_message: `You know where you must go from here, roughly. The footpath will branch into thick brush up ahead. And a ways beyond that brush, a wooden footbridge.\n//             <div class=\"meditation-1\">\n//             <br /><br />\n//             \"And know that you have changed, dear. That your ascent has taught you something.\"\n//             </div>`,\n//         transitions: [\n//             [['turn', 'right', 'and descend the stairs'], 'base, regarding path'],\n//             [['turn', 'around', 'and proceed along the platform'], 'stairs 2, descending']]\n//     },\n//     {\n//         id: 'base, regarding path',\n//         enter_message: `What lies within the brush you know you will enter, but which you can no longer see from this low vantage? What will it be like to walk across the footbridge?\n//             <br /><br />\n//             <i>(End of demo. Thanks for playing!)</i>`,\n//         transitions: []\n//     }\n// ]);\n\n\n// WEBPACK FOOTER //\n// ./src/typescript/venience/observer_moments.ts"],"sourceRoot":""}